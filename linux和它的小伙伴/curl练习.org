# -*- org-export-use-babel: t; org-confirm-babel-evaluate: nil; -*-
#+TITLE: curl练习
#+AUTHOR: lujun9972
#+TAGS: linux和它的小伙伴
#+DATE: [2019-09-11 三 15:26]
#+LANGUAGE:  zh-CN
#+STARTUP:  inlineimages
#+OPTIONS:  H:6 num:nil toc:t \n:nil ::t |:t ^:nil -:nil f:t *:t <:nil

从 https://jvns.ca/blog/2019/08/27/curl-exercises/?utm_source=programmingdigest&utm_medium=web&utm_campaign=featured 上看到了一些 curl 的练习，觉得不错，尝试做一下，增强对 curl 的理解。

* curl 的用法

[[file:images/curl.jpg]]

* 练习

+ Request https://httpbin.org
  #+begin_src shell :results org :exports both
    curl https://httpbin.org |head
  #+end_src

  #+RESULTS:
  #+begin_src org
  <!DOCTYPE html>
  <html lang="en">

  <head>
      <meta charset="UTF-8">
      <title>httpbin.org</title>
      <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Source+Code+Pro:300,600|Titillium+Web:400,600,700"
          rel="stylesheet">
      <link rel="stylesheet" type="text/css" href="/flasgger_static/swagger-ui.css">
      <link rel="icon" type="image/png" href="/static/favicon.ico" sizes="64x64 32x32 16x16" />
  #+end_src

+ Request https://httpbin.org/anything. httpbin.org/anything will look at the request you made, parse it, and echo back to you what you requested. curl’s default is to make a GET request.
  #+begin_src shell :results org :exports both
    curl https://httpbin.org/anything
  #+end_src

  #+RESULTS:
  #+begin_src org
  {
    "args": {}, 
    "data": "", 
    "files": {}, 
    "form": {}, 
    "headers": {
      "Accept": "*/*", 
      "Host": "httpbin.org", 
      "User-Agent": "curl/7.58.0"
    }, 
    "json": null, 
    "method": "GET", 
    "origin": "61.142.7.18, 61.142.7.18", 
    "url": "https://httpbin.org/anything"
  }
  #+end_src

+ Make a POST request to https://httpbin.org/anything
  #+begin_src shell :results org :exports both
    curl -X post https://httpbin.org/anything
  #+end_src

  #+RESULTS:
  #+begin_src org
  {
    "args": {}, 
    "data": "", 
    "files": {}, 
    "form": {}, 
    "headers": {
      "Accept": "*/*", 
      "Content-Length": "0", 
      "Host": "httpbin.org", 
      "User-Agent": "curl/7.58.0"
    }, 
    "json": null, 
    "method": "POST", 
    "origin": "61.142.7.18, 61.142.7.18", 
    "url": "https://httpbin.org/anything"
  }
  #+end_src

+ Make a GET request to https://httpbin.org/anything, but this time add some query parameters (set value=panda).
  #+begin_src shell :results org :exports both
    curl 'https://httpbin.org/anything?name=darksun&id=1'
  #+end_src

  #+RESULTS:
  #+begin_src org
  {
    "args": {
      "id": "1", 
      "name": "darksun"
    }, 
    "data": "", 
    "files": {}, 
    "form": {}, 
    "headers": {
      "Accept": "*/*", 
      "Host": "httpbin.org", 
      "User-Agent": "curl/7.58.0"
    }, 
    "json": null, 
    "method": "GET", 
    "origin": "61.142.7.18, 61.142.7.18", 
    "url": "https://httpbin.org/anything?name=darksun&id=1"
  }
  #+end_src

+ Request google’s robots.txt file (www.google.com/robots.txt)
  #+begin_src shell :results org   :exports both
    curl https://www.google.com/robots.txt
  #+end_src

+ Make a GET request to https://httpbin.org/anything and set the header User-Agent: elephant.
  #+begin_src shell :results org :exports both
    curl -H "User-Agent: elephant" 'https://httpbin.org/anything'
  #+end_src

  #+RESULTS:
  #+begin_src org
  {
    "args": {}, 
    "data": "", 
    "files": {}, 
    "form": {}, 
    "headers": {
      "Accept": "*/*", 
      "Host": "httpbin.org", 
      "User-Agent": "elephant"
    }, 
    "json": null, 
    "method": "GET", 
    "origin": "61.142.7.18, 61.142.7.18", 
    "url": "https://httpbin.org/anything"
  }
  #+end_src

+ Make a DELETE request to https://httpbin.org/anything
  #+begin_src shell :results org :exports both
    curl -X delete 'https://httpbin.org/anything'
  #+end_src

  #+RESULTS:
  #+begin_src org
  {
    "args": {}, 
    "data": "", 
    "files": {}, 
    "form": {}, 
    "headers": {
      "Accept": "*/*", 
      "Host": "httpbin.org", 
      "User-Agent": "curl/7.58.0"
    }, 
    "json": null, 
    "method": "DELETE", 
    "origin": "61.142.7.18, 61.142.7.18", 
    "url": "https://httpbin.org/anything"
  }
  #+end_src

+ Request https://httpbin.org/anything and also get the response headers
  #+begin_src shell :results org :exports both
    curl -i 'https://httpbin.org/anything'
  #+end_src

  #+RESULTS:
  #+begin_src org
  HTTP/1.1 200 OK
  Access-Control-Allow-Credentials: true
  Access-Control-Allow-Origin: *
  Content-Type: application/json
  Date: Wed, 11 Sep 2019 07:43:57 GMT
  Referrer-Policy: no-referrer-when-downgrade
  Server: nginx
  X-Content-Type-Options: nosniff
  X-Frame-Options: DENY
  X-XSS-Protection: 1; mode=block
  Content-Length: 286
  Connection: keep-alive
  
  {
    "args": {}, 
    "data": "", 
    "files": {}, 
    "form": {}, 
    "headers": {
      "Accept": "*/*", 
      "Host": "httpbin.org", 
      "User-Agent": "curl/7.58.0"
    }, 
    "json": null, 
    "method": "GET", 
    "origin": "61.142.7.18, 61.142.7.18", 
    "url": "https://httpbin.org/anything"
  }
  #+end_src

+ Make a POST request to https://httpbin.com/anything with the JSON body {"value": "panda"}
  #+begin_src shell :results org :exports both
    curl -X post 'https://httpbin.org/anything' --data '{"value":"panda"}'
  #+end_src

  #+RESULTS:
  #+begin_src org
  {
    "args": {}, 
    "data": "", 
    "files": {}, 
    "form": {
      "{\"value\":\"panda\"}": ""
    }, 
    "headers": {
      "Accept": "*/*", 
      "Content-Length": "17", 
      "Content-Type": "application/x-www-form-urlencoded", 
      "Host": "httpbin.org", 
      "User-Agent": "curl/7.58.0"
    }, 
    "json": null, 
    "method": "POST", 
    "origin": "61.142.7.18, 61.142.7.18", 
    "url": "https://httpbin.org/anything"
  }
  #+end_src

+ Make the same POST request as the previous exercise, but set the Content-Type header to application/json (because POST requests need to have a content type that matches their body). Look at the json field in the response to see the difference from the previous one.
  #+begin_src shell :results org :exports both
    curl -X post -H 'Content-Type: application/json' 'https://httpbin.org/anything' --data '{"value":"panda"}'
  #+end_src

  #+RESULTS:
  #+begin_src org
  {
    "args": {}, 
    "data": "{\"value\":\"panda\"}", 
    "files": {}, 
    "form": {}, 
    "headers": {
      "Accept": "*/*", 
      "Content-Length": "17", 
      "Content-Type": "application/json", 
      "Host": "httpbin.org", 
      "User-Agent": "curl/7.58.0"
    }, 
    "json": {
      "value": "panda"
    }, 
    "method": "POST", 
    "origin": "61.142.7.18, 61.142.7.18", 
    "url": "https://httpbin.org/anything"
  }
  #+end_src

+ Make a GET request to https://httpbin.org/anything and set the header Accept-Encoding: gzip (what happens? why?)
  #+begin_src shell :results org :exports both
    curl -X post -H 'Accept-Encoding: gzip' 'https://httpbin.org/anything' |gzip -d
  #+end_src

  #+RESULTS:
  #+begin_src org
  {
    "args": {}, 
    "data": "", 
    "files": {}, 
    "form": {}, 
    "headers": {
      "Accept": "*/*", 
      "Accept-Encoding": "gzip", 
      "Content-Length": "0", 
      "Host": "httpbin.org", 
      "User-Agent": "curl/7.58.0"
    }, 
    "json": null, 
    "method": "POST", 
    "origin": "61.142.7.18, 61.142.7.18", 
    "url": "https://httpbin.org/anything"
  }
  #+end_src

+ Put a bunch of a JSON in a file and then make a POST request to https://httpbin.org/anything with the JSON in that file as the body
  #+begin_src shell :results org :exports both
    tmp=$(mktemp)
    title="TEST OF JQ"
    source="JQ NB"
    echo '{}'|jq '{"title":$title,"content":$source}' --arg title "$title" --arg source "$source" >${tmp}
    curl -X post -H 'Content-Type: application/json'  'https://httpbin.org/anything' --data @${tmp}
  #+end_src

  #+RESULTS:
  #+begin_src org
  {
    "args": {}, 
    "data": "{  \"title\": \"TEST OF JQ\",  \"content\": \"JQ NB\"}", 
    "files": {}, 
    "form": {}, 
    "headers": {
      "Accept": "*/*", 
      "Content-Length": "46", 
      "Content-Type": "application/json", 
      "Host": "httpbin.org", 
      "User-Agent": "curl/7.58.0"
    }, 
    "json": {
      "content": "JQ NB", 
      "title": "TEST OF JQ"
    }, 
    "method": "POST", 
    "origin": "61.142.7.18, 61.142.7.18", 
    "url": "https://httpbin.org/anything"
  }
  #+end_src

+ Make a request to https://httpbin.org/image and set the header ‘Accept: image/png’. Save the output to a PNG file and open the file in an image viewer. Try the same thing with with different Accept: headers.
  #+begin_src shell :results file  :exports both
    png=$(mktemp "XXXXX.png")
    curl -H "Accept: image/png" https://httpbin.org/image >${png}
    printf ${png}
  #+end_src

  #+RESULTS:
  [[file:v33lH.png]]


+ Make a PUT request to https://httpbin.org/anything
  #+begin_src shell :results org :exports both
    curl -X put  https://httpbin.org/anything
  #+end_src

  #+RESULTS:
  #+begin_src org
  {
    "args": {}, 
    "data": "", 
    "files": {}, 
    "form": {}, 
    "headers": {
      "Accept": "*/*", 
      "Content-Length": "0", 
      "Host": "httpbin.org", 
      "User-Agent": "curl/7.58.0"
    }, 
    "json": null, 
    "method": "PUT", 
    "origin": "61.142.7.18, 61.142.7.18", 
    "url": "https://httpbin.org/anything"
  }
  #+end_src

+ Request https://httpbin.org/image/jpeg, save it to a file, and open that file in your image editor.
  #+begin_src shell :results file  :exports both
    img=$(mktemp "XXXXX.jpg")
    curl https://httpbin.org/image/jpeg >${img}
    printf ${img}
  #+end_src

  #+RESULTS:
  [[file:DZzyH.jpg]]
  

+ Request https://www.twitter.com. You’ll get an empty response. Get curl to show you the response headers too, and try to figure out why the response was empty.
  #+begin_src shell :results org :exports both
    curl -i https://www.twitter.com
  #+end_src

+ Make any request to https://httpbin.org/anything and just set some nonsense headers (like panda: elephant)
  #+begin_src shell :results org :exports both
    curl -H "panda: elephant" https://httpbin.org/anything
  #+end_src

  #+RESULTS:
  #+begin_src org
  {
    "args": {}, 
    "data": "", 
    "files": {}, 
    "form": {}, 
    "headers": {
      "Accept": "*/*", 
      "Host": "httpbin.org", 
      "Panda": "elephant", 
      "User-Agent": "curl/7.58.0"
    }, 
    "json": null, 
    "method": "GET", 
    "origin": "61.142.7.18, 61.142.7.18", 
    "url": "https://httpbin.org/anything"
  }
  #+end_src

+ Request https://httpbin.org/status/404 and https://httpbin.org/status/200. Request them again and get curl to show the response headers.
  #+begin_src shell :results org :exports both
    curl -i  https://httpbin.org/status/404
    curl -i  https://httpbin.org/status/200
  #+end_src

  #+RESULTS:
  #+begin_src org
  HTTP/1.1 404 NOT FOUND
  Access-Control-Allow-Credentials: true
  Access-Control-Allow-Origin: *
  Content-Type: text/html; charset=utf-8
  Date: Wed, 11 Sep 2019 11:20:41 GMT
  Referrer-Policy: no-referrer-when-downgrade
  Server: nginx
  X-Content-Type-Options: nosniff
  X-Frame-Options: DENY
  X-XSS-Protection: 1; mode=block
  Content-Length: 0
  Connection: keep-alive
  
  HTTP/1.1 200 OK
  Access-Control-Allow-Credentials: true
  Access-Control-Allow-Origin: *
  Content-Type: text/html; charset=utf-8
  Date: Wed, 11 Sep 2019 11:20:43 GMT
  Referrer-Policy: no-referrer-when-downgrade
  Server: nginx
  X-Content-Type-Options: nosniff
  X-Frame-Options: DENY
  X-XSS-Protection: 1; mode=block
  Content-Length: 0
  Connection: keep-alive
  
  #+end_src

+ Request https://httpbin.org/anything and set a username and password (with -u username:password)
  #+begin_src shell :results org :exports both
    curl -u lujun9972:1233 https://httpbin.org/anything
  #+end_src

  #+RESULTS:
  #+begin_src org
  {
    "args": {}, 
    "data": "", 
    "files": {}, 
    "form": {}, 
    "headers": {
      "Accept": "*/*", 
      "Authorization": "Basic bHVqdW45OTcyOjEyMzM=", 
      "Host": "httpbin.org", 
      "User-Agent": "curl/7.58.0"
    }, 
    "json": null, 
    "method": "GET", 
    "origin": "61.142.7.18, 61.142.7.18", 
    "url": "https://httpbin.org/anything"
  }
  #+end_src

+ Download the Twitter homepage (https://twitter.com) in Spanish by setting the Accept-Language: es-ES header.
  #+begin_src shell :results org  :exports both
    curl -H "Accept-Language: es-ES" https://twitter.com
  #+end_src
