#+TITLE: /dev/urandomå’Œ/dev/randomçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ
#+AUTHOR: lujun9972
#+TAGS: linuxå’Œå®ƒçš„å°ä¼™ä¼´
#+DATE: [2018-02-05 ä¸€ 17:17]
#+LANGUAGE:  zh-CN
#+OPTIONS:  H:6 num:nil toc:t \n:nil ::t |:t ^:nil -:nil f:t *:t <:nil

linuxä¸­æä¾›äº† =/dev/urandom= å’Œ =/dev/random= ä¸¤ä¸ªç‰¹æ®Šè®¾å¤‡æ¥æä¾›éšæœºæ•°ã€‚é‚£ä¹ˆè¿™ä¸¤ä¸ªæ–‡ä»¶æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ

è¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œå…ˆéœ€è¦äº†è§£ç†µè¿™ä¸ªæ¦‚å¿µã€‚
* ç†µ
linuxæ˜¯æ ¹æ®ç³»ç»Ÿçš„ç†µæ± æ¥äº§ç”Ÿéšæœºæ•°çš„ã€‚ç†µæ± å°±æ˜¯ç³»ç»Ÿå½“å‰çš„ç¯å¢ƒå™ªéŸ³,ç¯å¢ƒå™ªéŸ³çš„æ¥æºå¾ˆå¤šï¼Œé”®ç›˜çš„è¾“å…¥ã€é¼ æ ‡çš„ç§»åŠ¨ã€å†…å­˜çš„ä½¿ç”¨ã€æ–‡ä»¶çš„ä½¿ç”¨é‡ã€è¿›ç¨‹æ•°é‡ç­‰ç­‰ã€‚

å½“ç³»ç»Ÿçš„ç†µä¸å¤Ÿå¤§çš„æ—¶å€™ï¼Œåˆ™ç³»ç»Ÿäº§ç”Ÿçš„éšæœºæ•°éšæœºæ•ˆæœå°±ä¸æ˜¯å¾ˆå¥½ï¼Œä¹Ÿå°±æ˜¯è¯´æ›´å®¹æ˜“è¢«äººçŒœæµ‹å‡ºæ¥ã€‚

** å¦‚ä½•æŸ¥çœ‹ç³»ç»Ÿä¸­çš„ç†µ

é€šè¿‡ä¸‹é¢å‘½ä»¤å¯ä»¥æŸ¥çœ‹ç³»ç»Ÿç†µæ± çš„å®¹é‡:
#+BEGIN_SRC shell
  cat /proc/sys/kernel/random/poolsize
#+END_SRC

#+RESULTS:
: 4096

é€šè¿‡ä¸‹é¢å‘½ä»¤å¯ä»¥æŸ¥çœ‹ç³»ç»Ÿç†µæ± ä¸­æ‹¥æœ‰çš„ç†µæ•°:
#+BEGIN_SRC shell
  cat /proc/sys/kernel/random/entropy_avail 
#+END_SRC

#+RESULTS:
: 3734

** å¦‚ä½•å¿«é€Ÿç”Ÿæˆç†µ
é€šè¿‡å¼€å¯ =haveged= æœåŠ¡å¯ä»¥å¿«é€Ÿäº§ç”Ÿç†µã€‚è‹¥ =entropy_avail= çš„å€¼å°äº1000,åˆ™å»ºè®®å®‰è£… =haveged=,å¦åˆ™åŠ å¯†ç¨‹åºä¼šé˜»å¡ç›´åˆ°ç³»ç»Ÿæœ‰è¶³å¤Ÿçš„ç†µåæ‰ç»§ç»­è¿è¡Œã€‚

#+BEGIN_SRC shell :dir /sudo:: :results org
  pacman -S haveged --noconfirm
#+END_SRC

#+RESULTS:
#+BEGIN_SRC org
resolving dependencies...
looking for conflicting packages...

[0;1mPackages (1)[0m haveged-1.9.1-4

[0;1mTotal Download Size: [0m  0.04 MiB
[0;1mTotal Installed Size:[0m  0.14 MiB

[1;34m::[0;1m Proceed with installation? [Y/n] [0m
[1;34m::[0;1m Retrieving packages...
[0m haveged-1.9.1-4-x86_64     0.0   B  0.00B/s 00:00 [[1;33mc[m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m]   0% haveged-1.9.1-4-x86_64     0.0   B  0.00B/s 00:00 [[1;33mc[m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m]   0% haveged-1.9.1-4-x86_64     0.0   B  0.00B/s 00:00 [[1;33mc[m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m]   0% haveged-1.9.1-4-x86_64     0.0   B  0.00B/s 00:00 [[1;33mc[m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m]   0% haveged-1.9.1-4-x86_64     0.0   B  0.00B/s 00:00 [[1;33mc[m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m]   0% haveged-1.9.1-4-x86_64     0.0   B  0.00B/s 00:00 [[1;33mc[m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m]   0% haveged-1.9.1-4-x86_64     0.0   B  0.00B/s 00:00 [[1;33mc[m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m]   0% haveged-1.9.1-4-x86_64     0.0   B  0.00B/s 00:00 [[1;33mc[m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m]   0% haveged-1.9.1-4-x86_64     0.0   B  0.00B/s 00:00 [[1;33mc[m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m]   0% haveged-1.9.1-4-x86_64     0.0   B  0.00B/s 00:00 [[1;33mc[m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m]   0% haveged-1.9.1-4-x86_64     0.0   B  0.00B/s 00:00 [[1;33mc[m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m]   0% haveged-1.9.1-4-x86_64     0.0   B  0.00B/s 00:00 [[1;33mc[m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m]   0% haveged-1.9.1-4-x86_64     0.0   B  0.00B/s 00:00 [[1;33mc[m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m]   0% haveged-1.9.1-4-x86_64    41.2 KiB   412K/s 00:00 [----------------------] 100%
(0/1) checking keys in keyring                     [[1;33mc[m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m]   0%(1/1) checking keys in keyring                     [----------------------] 100%
(0/1) checking package integrity                   [[1;33mc[m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m]   0%(1/1) checking package integrity                   [----------------------] 100%
(0/1) loading package files                        [[1;33mc[m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m]   0%(1/1) loading package files                        [----------------------] 100%
(0/1) checking for file conflicts                  [[1;33mc[m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m]   0%(1/1) checking for file conflicts                  [----------------------] 100%
(0/1) checking available disk space                [[1;33mc[m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m]   0%(1/1) checking available disk space                [----------------------] 100%
[1;34m::[0;1m Processing package changes...
[0m(1/1) installing haveged                           [[1;33mc[m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m[0;37mo[m[0;37m [m[0;37m [m]   0%(1/1) installing haveged                           [----------------------] 100%
[1;34m::[0;1m Running post-transaction hooks...
[0m(1/1) Arming ConditionNeedsUpdate...
#+END_SRC

ç„¶åå¼€å¯ =haveged= æœåŠ¡
#+BEGIN_SRC shell :dir /sudo:: :results org
  systemctl enable haveged
  systemctl start haveged
#+END_SRC

* /dev/random ä¸ /dev/urandom çš„åŒºåˆ«
=/dev/random= æ˜¯çœŸéšæœºæ•°ç”Ÿæˆå™¨ï¼Œå®ƒä¼šæ¶ˆè€—ç†µå€¼æ¥äº§ç”Ÿéšæœºæ•°ï¼ŒåŒæ—¶åœ¨ç†µè€—å°½çš„æƒ…å†µä¸‹ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰æ–°çš„ç†µç”Ÿæˆ. å…¶äº§ç”Ÿçš„éšæœºæ•ˆæœå¾ˆå¥½ã€‚

è€Œ =/dev/urandom= æ˜¯ä¼ªéšæœºæ•°ç”Ÿæˆå™¨ï¼Œå®ƒæ ¹æ®ä¸€ä¸ªåˆå§‹çš„éšæœºç§å­æ¥äº§ç”Ÿä¸€ç³»åˆ—çš„ä¼ªéšæœºæ•°ï¼Œè€Œå¹¶ä¸ä¼šæ¶ˆè€—ç†µï¼Œä¹Ÿä¸ä¼šåœ¨ç†µè€—å°½çš„æƒ…å†µä¸‹é˜»å¡ã€‚

ç»“åˆè¿™è€…çš„ç‰¹ç‚¹ï¼Œå¯ä»¥çœ‹å‡ºï¼Œé™¤éå¯¹å®‰å…¨æ€§éœ€è¦ç‰¹åˆ«çš„å…³æ³¨ï¼Œå¦åˆ™ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨ =/dev/urandom= æ¥äº§ç”Ÿéšæœºæ•°ï¼Œè¿™æ ·æ‰ä¸ä¼šå¼•èµ·ç¨‹åºè«åçš„æŒ‚èµ·ã€‚
