#+TITLE: ä½¿ç”¨lynisè¿›è¡Œlinuxæ¼æ´æ‰«æ
#+AUTHOR: lujun9972
#+TAGS: linuxå’Œå®ƒçš„å°ä¼™ä¼´
#+DATE: [2018-06-08 äº” 17:32]
#+LANGUAGE:  zh-CN
#+OPTIONS:  H:6 num:nil toc:t \n:nil ::t |:t ^:nil -:nil f:t *:t <:nil

lynis æ˜¯ä¸€æ¬¾è¿è¡Œåœ¨ Unix/Linux å¹³å°ä¸Šçš„åŸºäºä¸»æœºçš„ã€å¼€æºçš„å®‰å…¨å®¡è®¡è½¯ä»¶ã€‚

* å®‰è£…lynis
åœ¨ archlinux ä¸Šå¯ä»¥ç›´æ¥é€šè¿‡ pacman æ¥å®‰è£…
#+BEGIN_SRC shell :dir /sudo:: :results org
  sudo pacman -S lynis --noconfirm
#+END_SRC

#+BEGIN_SRC org
resolving dependencies...
looking for conflicting packages...

Packages (1) lynis-2.6.4-1

Total Installed Size:  1.35 MiB
Net Upgrade Size:      0.00 MiB

:: Proceed with installation? [Y/n] 
(0/1) checking keys in keyring                     [----------------------]   0%(1/1) checking keys in keyring                     [######################] 100%
(0/1) checking package integrity                   [----------------------]   0%(1/1) checking package integrity                   [######################] 100%
(0/1) loading package files                        [----------------------]   0%(1/1) loading package files                        [######################] 100%
(0/1) checking for file conflicts                  [----------------------]   0%(1/1) checking for file conflicts                  [######################] 100%
(0/1) checking available disk space                [----------------------]   0%(1/1) checking available disk space                [######################] 100%
:: Processing package changes...
(1/1) reinstalling lynis                           [----------------------]   0%(1/1) reinstalling lynis                           [######################] 100%
:: Running post-transaction hooks...
(1/2) Reloading system manager configuration...
(2/2) Arming ConditionNeedsUpdate...
#+END_SRC

* ä½¿ç”¨lynisè¿›è¡Œä¸»æœºæ‰«æ

é¦–å…ˆè®©æˆ‘ä»¬ä¸å¸¦ä»»ä½•å‚æ•°è¿è¡Œ lynis, è¿™ä¼šåˆ—å‡º lynis æ”¯æŒçš„é‚£äº›å‚æ•°
#+BEGIN_EXAMPLE
  [lujun9972@T520 linuxå’Œå®ƒçš„å°ä¼™ä¼´]$ lynis

  [ Lynis 2.6.4 ]

  ################################################################################
    Lynis comes with ABSOLUTELY NO WARRANTY. This is free software, and you are
    welcome to redistribute it under the terms of the GNU General Public License.
    See the LICENSE file for details about using this software.

    2007-2018, CISOfy - https://cisofy.com/lynis/
    Enterprise support available (compliance, plugins, interface and tools)
  ################################################################################


  [+] Initializing program
  ------------------------------------


    Usage: lynis command [options]


    Command:

      audit
          audit system                  : Perform local security scan
          audit system remote <host>    : Remote security scan
          audit dockerfile <file>       : Analyze Dockerfile

      show
          show                          : Show all commands
          show version                  : Show Lynis version
          show help                     : Show help

      update
          update info                   : Show update details


    Options:

      --no-log                          : Don't create a log file
      --pentest                         : Non-privileged scan (useful for pentest)
      --profile <profile>               : Scan the system with the given profile file
      --quick (-Q)                      : Quick mode, don't wait for user input

      Layout options
      --no-colors                       : Don't use colors in output
      --quiet (-q)                      : No output
      --reverse-colors                  : Optimize color display for light backgrounds

      Misc options
      --debug                           : Debug logging to screen
      --view-manpage (--man)            : View man page
      --verbose                         : Show more details on screen
      --version (-V)                    : Display version number and quit

      Enterprise options
      --plugindir <path>                : Define path of available plugins
      --upload                          : Upload data to central node

      More options available. Run '/usr/bin/lynis show options', or use the man page.

    No command provided. Exiting..
#+END_EXAMPLE

ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨ lynis è¿›è¡Œä¸»æœºæ‰«æå¾ˆç®€å•ï¼Œåªéœ€è¦å¸¦ä¸Šå‚æ•° =audit system= å³å¯ã€‚
Lynisåœ¨å®¡è®¡çš„è¿‡ç¨‹ä¸­,ä¼šè¿›è¡Œå¤šç§ç±»ä¼¼çš„æµ‹è¯•,åœ¨å®¡è®¡è¿‡ç¨‹ä¸­ä¼šå°†å„ç§æµ‹è¯•ç»“æœã€è°ƒè¯•ä¿¡æ¯ã€å’Œå¯¹ç³»ç»Ÿçš„åŠ å›ºå»ºè®®éƒ½è¢«å†™åˆ° stdin ã€‚
æˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸‹é¢å‘½ä»¤æ¥è·³è¿‡æ£€æŸ¥è¿‡ç¨‹,ç›´æ¥æˆªå–æœ€åçš„æ‰«æå»ºè®®æ¥çœ‹ã€‚
#+BEGIN_SRC shell :dir /sudo:: :results org
  sudo lynis audit system |sed '1,/Results/d'
#+END_SRC

lyniså°†æ‰«æçš„å†…å®¹åˆ†æˆå‡ å¤§ç±»ï¼Œå¯ä»¥é€šè¿‡ =show groups= å‚æ•°æ¥è·å–ç±»åˆ«
#+BEGIN_SRC shell :results org
  lynis show groups
#+END_SRC

#+BEGIN_SRC org
accounting
authentication
banners
boot_services
containers
crypto
databases
dns
file_integrity
file_permissions
filesystems
firewalls
hardening
homedirs
insecure_services
kernel
kernel_hardening
ldap
logging
mac_frameworks
mail_messaging
malware
memory_processes
nameservices
networking
php
ports_packages
printers_spools
scheduling
shells
snmp
squid
ssh
storage
storage_nfs
system_integrity
time
tooling
usb
virtualization
webservers

#+END_SRC

è‹¥æŒ‡å‘æ‰«ææŸå‡ ç±»çš„å†…å®¹ï¼Œåˆ™å¯ä»¥é€šè¿‡ =--tests-from-group= å‚æ•°æ¥æŒ‡å®šã€‚

æ¯”å¦‚æˆ‘åªæƒ³æ‰«æ shells å’Œ networking æ–¹é¢çš„å†…å®¹ï¼Œåˆ™å¯ä»¥æ‰§è¡Œ
#+BEGIN_SRC shell :dir /sudo:: :results org
  sudo lynis --tests-from-group "shells networking" --no-colors
#+END_SRC

#+RESULTS:
#+BEGIN_SRC org

[ Lynis 2.6.4 ]

################################################################################
  Lynis comes with ABSOLUTELY NO WARRANTY. This is free software, and you are
  welcome to redistribute it under the terms of the GNU General Public License.
  See the LICENSE file for details about using this software.

  2007-2018, CISOfy - https://cisofy.com/lynis/
  Enterprise support available (compliance, plugins, interface and tools)
################################################################################


[+] Initializing program
------------------------------------
[2C- Detecting OS... [41C [ DONE ]
[2C- Checking profiles...[37C [ DONE ]
[2C- Detecting language and localization[22C [ zh ]
[4CNotice: no language file found for 'zh' (tried: /usr/share/lynis/db/languages/zh)[0C

  ---------------------------------------------------
  Program version:           2.6.4
  Operating system:          Linux
  Operating system name:     Arch Linux
  Operating system version:  Rolling release
  Kernel version:            4.16.13
  Hardware platform:         x86_64
  Hostname:                  T520
  ---------------------------------------------------
  Profiles:                  /etc/lynis/default.prf
  Log file:                  /var/log/lynis.log
  Report file:               /var/log/lynis-report.dat
  Report version:            1.0
  Plugin directory:          /usr/share/lynis/plugins
  ---------------------------------------------------
  Auditor:                   [Not Specified]
  Language:                  zh
  Test category:             all
  Test group:                shells networking
  ---------------------------------------------------
[2C- Program update status... [32C [ NO UPDATE ]

[+] System Tools
------------------------------------
[2C- Scanning available tools...[30C
[2C- Checking system binaries...[30C

[+] Plugins (phase 1)
------------------------------------
[0CNote: plugins have more extensive tests and may take several minutes to complete[0C
[0C [0C
[2C- Plugins enabled[42C [ NONE ]

[+] Shells
------------------------------------
[2C- Checking shells from /etc/shells[25C
[4CResult: found 5 shells (valid shells: 5).[16C
[4C- Session timeout settings/tools[25C [ NONE ]
[2C- Checking default umask values[28C
[4C- Checking default umask in /etc/bash.bashrc[13C [ NONE ]
[4C- Checking default umask in /etc/profile[17C [ WEAK ]

[+] Networking
------------------------------------
[2C- Checking IPv6 configuration[30C [ ENABLED ]
[6CConfiguration method[35C [ AUTO ]
[6CIPv6 only[46C [ NO ]
[2C- Checking configured nameservers[26C
[4C- Testing nameservers[36C
[6CNameserver: 202.96.134.33[30C [ SKIPPED ]
[6CNameserver: 202.96.128.86[30C [ SKIPPED ]
[4C- Minimal of 2 responsive nameservers[20C [ SKIPPED ]
[2C- Getting listening ports (TCP/UDP)[24C [ DONE ]
[6C* Found 11 ports[39C
[2C- Checking status DHCP client[30C [ RUNNING ]
[2C- Checking for ARP monitoring software[21C [ NOT FOUND ]

[+] Custom Tests
------------------------------------
[2C- Running custom tests... [33C [ NONE ]

[+] Plugins (phase 2)
------------------------------------

================================================================================

  -[ Lynis 2.6.4 Results ]-

  Great, no warnings

  Suggestions (1):
  ----------------------------
  ,* Consider running ARP monitoring software (arpwatch,arpon) [NETW-3032] 
      https://cisofy.com/controls/NETW-3032/

  Follow-up:
  ----------------------------
  - Show details of a test (lynis show details TEST-ID)
  - Check the logfile for all details (less /var/log/lynis.log)
  - Read security controls texts (https://cisofy.com)
  - Use --upload to upload data to central system (Lynis Enterprise users)

================================================================================

  Lynis security scan details:

  Hardening index : 33 [######              ]
  Tests performed : 13
  Plugins enabled : 0

  Components:
  - Firewall               [X]
  - Malware scanner        [X]

  Lynis Modules:
  - Compliance Status      [?]
  - Security Audit         [V]
  - Vulnerability Scan     [V]

  Files:
  - Test and debug information      : /var/log/lynis.log
  - Report data                     : /var/log/lynis-report.dat

================================================================================

  Lynis 2.6.4

  Auditing, system hardening, and compliance for UNIX-based systems
  (Linux, macOS, BSD, and others)

  2007-2018, CISOfy - https://cisofy.com/lynis/
  Enterprise support available (compliance, plugins, interface and tools)

================================================================================

  [TIP]: Enhance Lynis audits by adding your settings to custom.prf (see /etc/lynis/default.prf for all settings)

#+END_SRC
** æŸ¥çœ‹è¯¦ç»†è¯´æ˜
åœ¨æŸ¥çœ‹å®¡è®¡ç»“æœæ—¶,ä½ å¯ä»¥é€šè¿‡ =show details= å‚æ•°æ¥è·å–å…³äºæŸæ¡è­¦å‘Š/å»ºè®®çš„è¯¦ç»†è¯´æ˜ã€‚å…¶å¯¹åº”çš„å‘½ä»¤å½¢å¼ä¸º:

#+BEGIN_SRC shell
  lynis show details ${test_id}
#+END_SRC

æ¯”å¦‚ï¼Œä¸Šé¢å›¾ä¸­æœ‰ä¸€ä¸ªå»ºè®®
#+BEGIN_EXAMPLE
  ,* Consider running ARP monitoring software (arpwatch,arpon) [NETW-3032] 
#+END_EXAMPLE

æˆ‘ä»¬å¯ä»¥è¿è¡Œå‘½ä»¤ï¼š

#+BEGIN_SRC shell :dir /sudo:: :results org
  sudo lynis show details NETW-3032 
#+END_SRC

#+BEGIN_SRC org
2018-06-08 18:18:01 Performing test ID NETW-3032 (Checking for ARP monitoring software)
2018-06-08 18:18:01 IsRunning: process 'arpwatch' not found
2018-06-08 18:18:01 IsRunning: process 'arpon' not found
2018-06-08 18:18:01 Suggestion: Consider running ARP monitoring software (arpwatch,arpon) [test:NETW-3032] [details:-] [solution:-]
2018-06-08 18:18:01 Checking permissions of /usr/share/lynis/include/tests_printers_spools
2018-06-08 18:18:01 File permissions are OK
2018-06-08 18:18:01 ===---------------------------------------------------------------===
#+END_SRC

   
** æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
lynisåœ¨å®¡è®¡å®Œæˆåä¼šå°†è¯¦ç»†çš„ä¿¡æ¯è®°å½•åœ¨ =/var/log/lynis.log= ä¸­.
#+BEGIN_SRC shell :results org :dir /sudo::
  sudo tail /var/log/lynis.log
#+END_SRC

#+BEGIN_SRC org
2018-06-08 17:59:46 ================================================================================
2018-06-08 17:59:46 Lynis 2.6.4
2018-06-08 17:59:46 2007-2018, CISOfy - https://cisofy.com/lynis/
2018-06-08 17:59:46 Enterprise support available (compliance, plugins, interface and tools)
2018-06-08 17:59:46 Program ended successfully
2018-06-08 17:59:46 ================================================================================
2018-06-08 17:59:46 PID file removed (/var/run/lynis.pid)
2018-06-08 17:59:46 Temporary files:  /tmp/lynis.sGxCR0hSPz
2018-06-08 17:59:46 Action: removing temporary file /tmp/lynis.sGxCR0hSPz
2018-06-08 17:59:46 Lynis ended successfully.
#+END_SRC

åŒæ—¶å°†æŠ¥å‘Šæ•°æ®è¢«ä¿å­˜åˆ° =/var/log/lynis-report.dat= ä¸­.
#+BEGIN_SRC shell :results org :dir /sudo::
  sudo tail /var/log/lynis-report.dat
#+END_SRC

#+RESULTS:
#+BEGIN_SRC org
network_listen_port[]=[::ffff:14.120.31.247]:51224
suggestion[]=NETW-3032|Consider running ARP monitoring software (arpwatch,arpon)|-|-|
dhcp_client_running=1
arpwatch_running=0
lynis_tests_done=13
report_datetime_end=2018-06-08 17:59:46
hardening_index=33
tests_executed=NETW-3032|NETW-3030|NETW-3012|NETW-3008|NETW-3006|NETW-3004|NETW-2705|NETW-2704|NETW-2600|SHLL-6230|SHLL-6220|SHLL-6211|CORE-1000|
tests_skipped=NETW-3028|NETW-3015|NETW-3014|NETW-3001|SHLL-6202|
finish=true
#+END_SRC

å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯æ¬¡å®¡è®¡éƒ½ä¼šè¦†ç›–åŸæ—¥å¿—æ–‡ä»¶.

* æ£€æŸ¥æ›´æ–°
å®¡è®¡è½¯ä»¶éœ€è¦éšæ—¶è¿›è¡Œæ›´æ–°ä»è€Œå¾—åˆ°æœ€æ–°çš„å»ºè®®å’Œä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ =update info= å‚æ•°æ¥æ£€æŸ¥æ›´æ–°:
#+BEGIN_SRC shell :dir /sudo:: :results org
  lynis update info --no-colors
#+END_SRC

#+BEGIN_SRC org

 == [1;37mLynis[0m ==

  Version            : 2.6.4
  Status             : [1;32mUp-to-date[0m
  Release date       : 2018-05-02
  Update location    : https://cisofy.com/lynis/


2007-2018, CISOfy - https://cisofy.com/lynis/

#+END_SRC

* è‡ªå®šä¹‰lyniså®‰å…¨å®¡è®¡ç­–ç•¥
lynisçš„é…ç½®ä¿¡æ¯ä»¥ =.prf= æ–‡ä»¶çš„æ ¼å¼ä¿å­˜åœ¨ =/etc/lynis= ç›®å½•ä¸­ã€‚
å…¶ä¸­ï¼Œé»˜è®¤lynisè‡ªå¸¦ä¸€ä¸ªåä¸º =default.prf= çš„é»˜è®¤é…ç½®æ–‡ä»¶ã€‚

ä¸è¿‡æˆ‘ä»¬æ— éœ€ç›´æ¥ä¿®æ”¹è¿™ä¸ªé»˜è®¤çš„é…ç½®æ–‡ä»¶ï¼Œåªéœ€è¦æ–°å¢ä¸€ä¸ª =custom.prf= æ–‡ä»¶å°†è‡ªå®šä¹‰çš„ä¿¡æ¯åŠ å…¥å…¶ä¸­å°±å¯ä»¥äº†ã€‚

å…³äºé…ç½®æ–‡ä»¶ä¸­å„é…ç½®é¡¹çš„æ„ä¹‰ï¼Œåœ¨ =default.prf= ä¸­éƒ½æœ‰ç›¸åº”çš„æ³¨é‡Šè¯´æ˜,è¿™é‡Œå°±ä¸è¯¦è¿°äº†ã€‚

æƒ³äº†è§£lynisçš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥è®¿é—®[[https://cisofy.com/documentation/lynis/][å®ƒçš„å®˜ç½‘.]]
