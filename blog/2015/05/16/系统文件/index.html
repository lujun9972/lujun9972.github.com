<!DOCTYPE html>
<html lang="en">
<head>
  <title>系统文件 - 暗无天日</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="author" content="DarkSun" />
  <style>
   #ds-thread #ds-reset .ds-comment-body p {color: #ffffff;}
   #disqus_thread a {color: #00ffff;}
  </style>
  <link rel="stylesheet" media="screen" href="../../../../../media/css/font.css" rel="stylesheet" type="text/css"/>
  <link rel="stylesheet" href="../../../../../media/css/main.css" type="text/css">
  <link rel="stylesheet" href="../../../../../media/css/org-src-fontify.css" type="text/css">
  <link rel="stylesheet" href="../../../../../media/css/kdComment.css" type="text/css">
  <script type="text/javascript"
          src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
</head>

  <body class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="../../../../../">暗无天日</a></h1>
    <p>=============&gt;随便,谢谢</p>
    <nav class="site-nav">
      <div class="menu-icon">
      </div>
      <ul class="trigger">
              <li><a href="../../../../../years/">Years</a></li>
              <li><a href="../../../../../tags/">Tags</a></li>
              <li><a href="../../../../../about/">About</a></li>
              <li><a href="https://github.com/lujun9972/lujun9972.github.com.git">Github</a></li>
              <li><a href="../../../../../rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="http://www.google.com/search">
        <input type="text" class="field" name="q" id="s" placeholder="Search">
        <input type="hidden" name="as_sitesearch" value="lujun9972.github.io">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">系统文件</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org7b4ce0e">1. passwd文件</a></li>
<li><a href="#org37732af">2. shadow文件</a></li>
<li><a href="#orgf09af5c">3. group文件</a></li>
<li><a href="#org8671895">4. 其他数据文件</a>
<ul>
<li><a href="#org0a897c8">4.1. hosts文件</a></li>
<li><a href="#orga0a91df">4.2. networks文件</a></li>
<li><a href="#org1214833">4.3. protocols文件</a></li>
<li><a href="#orgcf76e80">4.4. services文件</a></li>
</ul>
</li>
<li><a href="#orgcc4f867">5. 登录账户记录</a></li>
<li><a href="#org1abbe0d">6. 系统标识</a>
<ul>
<li><a href="#org333a86d">6.1. uname函数:获取当前主机与操作系统相关信息</a></li>
<li><a href="#orgb4a5cf2">6.2. gethostname函数:只返回主机名</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org7b4ce0e" class="outline-2">
<h2 id="org7b4ce0e"><span class="section-number-2">1</span> passwd文件</h2>
<div class="outline-text-2" id="text-1">
<p>
&lt;pwd.h&gt;中定义了passwd结构体,并提供了获取指定passwd项的函数
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;pwd.h&gt;</span>

<span class="org-comment-delimiter">/* </span><span class="org-comment">&#26681;&#25454;uid&#33719;&#21462;passwd&#39033;</span><span class="org-comment-delimiter"> */</span>
<span class="org-keyword">struct</span> <span class="org-type">passwd</span> *<span class="org-function-name">getpwuid</span>(<span class="org-type">uid_t</span> <span class="org-variable-name">uid</span>);
<span class="org-comment-delimiter">/* </span><span class="org-comment">&#26681;&#25454;&#29992;&#25143;&#21517;&#33719;&#21462;passwd&#39033;</span><span class="org-comment-delimiter"> */</span>
<span class="org-keyword">struct</span> <span class="org-type">passwd</span> *<span class="org-function-name">getpwname</span>(<span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">name</span>);

<span class="org-keyword">struct</span> <span class="org-type">passwd</span>{
  <span class="org-type">char</span>* <span class="org-variable-name">pw_name</span>;                <span class="org-comment-delimiter">/* </span><span class="org-comment">&#29992;&#25143;&#21517;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">char</span>* <span class="org-variable-name">pw_passwd</span>;              <span class="org-comment-delimiter">/* </span><span class="org-comment">&#21152;&#23494;&#23494;&#30721;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">uid_t</span> <span class="org-variable-name">pw_uid</span>;                 <span class="org-comment-delimiter">/* </span><span class="org-comment">&#25968;&#20540;&#29992;&#25143;ID</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">git_t</span> <span class="org-variable-name">pw_gid</span>;                 <span class="org-comment-delimiter">/* </span><span class="org-comment">&#25968;&#20540;&#32452;ID</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">char</span>* <span class="org-variable-name">pw_gecos</span>;               <span class="org-comment-delimiter">/* </span><span class="org-comment">&#27880;&#37322;&#23383;&#27573;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">char</span>* <span class="org-variable-name">pw_dir</span>;                 <span class="org-comment-delimiter">/* </span><span class="org-comment">&#21021;&#22987;&#24037;&#20316;&#30446;&#24405;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">char</span>* <span class="org-variable-name">pw_shell</span>;               <span class="org-comment-delimiter">/* </span><span class="org-comment">&#21021;&#22987;shell</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">char</span>* <span class="org-variable-name">pw_class</span>;               <span class="org-comment-delimiter">/* </span><span class="org-comment">&#29992;&#25143;&#35775;&#38382;&#31867;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">time_t</span> <span class="org-variable-name">pw_change</span>;             <span class="org-comment-delimiter">/* </span><span class="org-comment">&#19979;&#27425;&#26356;&#25913;&#23494;&#30721;&#26102;&#38388;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">time_t</span> <span class="org-variable-name">pw_expire</span>;             <span class="org-comment-delimiter">/* </span><span class="org-comment">&#36134;&#25143;&#21040;&#26399;&#26102;&#38388;</span><span class="org-comment-delimiter"> */</span>
}

</pre>
</div>

<p>
下面三个函数,则提供了遍历获取passwd项的函数
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;pwd.h&gt;</span>

<span class="org-comment-delimiter">/* </span><span class="org-comment">&#33509;&#26410;&#25171;&#24320;passwd&#25991;&#20214;&#21017;&#25171;&#24320;passwd&#25991;&#20214;,&#24182;&#23558;&#35835;&#25351;&#38024;&#25918;&#21040;&#31532;&#19968;&#26465;&#35760;&#24405;&#22788;</span><span class="org-comment-delimiter"> */</span>
<span class="org-type">void</span> <span class="org-function-name">setpwent</span>();
<span class="org-comment-delimiter">/* </span><span class="org-comment">&#33509;&#26410;&#25171;&#24320;passwd&#25991;&#20214;&#21017;&#25171;&#24320;passwd&#25991;&#20214;,&#24182;&#35835;&#21462;&#19979;&#19968;&#26465;passwd&#39033;</span><span class="org-comment-delimiter">*/</span>
<span class="org-keyword">struct</span> <span class="org-type">passwd</span>* <span class="org-function-name">getpwent</span>();
<span class="org-comment-delimiter">/* </span><span class="org-comment">&#20851;&#38381;passwd&#25991;&#20214;</span><span class="org-comment-delimiter"> */</span>
<span class="org-type">void</span> <span class="org-function-name">endpwent</span>();
</pre>
</div>
<p>
需要注意的是:
</p>
<ul class="org-ul">
<li>setpwent会自动检查是否已经打开了passwd文件,若打开了,则不会重复打开.</li>
<li>getpwent会自动在未调用setpwent打开passwd文件的情况下,自动打开该passwd.</li>
<li>使用getpwent查看完passwd文件后,一定要调用endpwent关闭这些文件.</li>
</ul>
</div>
</div>

<div id="outline-container-org37732af" class="outline-2">
<h2 id="org37732af"><span class="section-number-2">2</span> shadow文件</h2>
<div class="outline-text-2" id="text-2">
<p>
类似passwd相关函数
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;shadow.h&gt;</span>

<span class="org-comment-delimiter">/* </span><span class="org-comment">&#26681;&#25454;&#29992;&#25143;&#21517;&#33719;&#21462;shadow&#39033;</span><span class="org-comment-delimiter"> */</span>
<span class="org-keyword">struct</span> <span class="org-type">spwd</span>* <span class="org-function-name">getspnam</span>(<span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">name</span>);

<span class="org-keyword">struct</span> <span class="org-type">spwd</span>{
  <span class="org-type">char</span>* <span class="org-variable-name">sp_namp</span>;                <span class="org-comment-delimiter">/* </span><span class="org-comment">&#29992;&#25143;&#30331;&#24405;&#21517;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">char</span>* <span class="org-variable-name">sp_pwdp</span>;                <span class="org-comment-delimiter">/* </span><span class="org-comment">&#21152;&#23494;&#21475;&#20196;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">int</span> <span class="org-variable-name">sp_lstchg</span>;                <span class="org-comment-delimiter">/* </span><span class="org-comment">&#19978;&#27425;&#26356;&#25913;&#23494;&#30721;&#20197;&#26469;&#32463;&#36807;&#30340;&#26102;&#38388;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">int</span> <span class="org-variable-name">sp_min</span>;                   <span class="org-comment-delimiter">/* </span><span class="org-comment">&#32463;&#36807;&#22810;&#23569;&#22825;&#21518;&#20801;&#35768;&#26356;&#25913;&#23494;&#30721;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">int</span> <span class="org-variable-name">sp_max</span>;                   <span class="org-comment-delimiter">/* </span><span class="org-comment">&#22810;&#23569;&#22825;&#21518;&#35201;&#27714;&#26356;&#25913;&#23494;&#30721;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">int</span> <span class="org-variable-name">sp_warn</span>;                  <span class="org-comment-delimiter">/* </span><span class="org-comment">&#23494;&#30721;&#21040;&#26399;&#35686;&#21578;&#22825;&#25968;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">int</span> <span class="org-variable-name">sp_inact</span>;                 <span class="org-comment-delimiter">/* </span><span class="org-comment">&#36134;&#25143;&#22833;&#25928;&#21069;&#22825;&#25968;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">int</span> <span class="org-variable-name">sp_expire</span>;                <span class="org-comment-delimiter">/* </span><span class="org-comment">&#36134;&#25143;&#21040;&#26399;&#22825;&#25968;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">unsigned</span> <span class="org-type">int</span> <span class="org-variable-name">sp_flag</span>;         <span class="org-comment-delimiter">/* </span><span class="org-comment">&#20445;&#30041;</span><span class="org-comment-delimiter"> */</span>
}

<span class="org-comment-delimiter">/* </span><span class="org-comment">&#33509;&#26410;&#25171;&#24320;shadow&#25991;&#20214;&#21017;&#25171;&#24320;shadow&#25991;&#20214;,&#23558;&#35835;&#25351;&#38024;&#25918;&#21040;&#31532;&#19968;&#26465;&#35760;&#24405;&#22788;</span><span class="org-comment-delimiter"> */</span>
<span class="org-type">void</span> <span class="org-function-name">setspent</span>();
<span class="org-comment-delimiter">/* </span><span class="org-comment">&#33509;&#26410;&#25171;&#24320;shadow&#25991;&#20214;&#21017;&#25171;&#24320;shadow&#25991;&#20214;,&#35835;&#21462;&#19979;&#19968;&#26465;shadow&#35760;&#24405;</span><span class="org-comment-delimiter">*/</span>
<span class="org-keyword">struct</span> <span class="org-type">spwd</span>* <span class="org-function-name">getspent</span>();
<span class="org-comment-delimiter">/* </span><span class="org-comment">&#20851;&#38381;shaodw&#25991;&#20214;</span><span class="org-comment-delimiter"> */</span>
<span class="org-type">void</span> <span class="org-function-name">endspent</span>();
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf09af5c" class="outline-2">
<h2 id="orgf09af5c"><span class="section-number-2">3</span> group文件</h2>
<div class="outline-text-2" id="text-3">
<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;grp.h&gt;</span>

<span class="org-comment-delimiter">/* </span><span class="org-comment">&#26681;&#25454;gid&#33719;&#21462;group&#39033;</span><span class="org-comment-delimiter"> */</span>
<span class="org-keyword">struct</span> <span class="org-type">group</span>* <span class="org-function-name">getgrgid</span>(<span class="org-type">gid_t</span> <span class="org-variable-name">gid</span>);
<span class="org-comment-delimiter">/* </span><span class="org-comment">&#26681;&#25454;&#32452;&#21517;&#31216;,&#33719;&#21462;group&#39033;</span><span class="org-comment-delimiter"> */</span>
<span class="org-keyword">struct</span> <span class="org-type">group</span>* <span class="org-function-name">getgrnam</span>(<span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">name</span>);

<span class="org-keyword">struct</span> <span class="org-type">group</span>{
  <span class="org-type">char</span>* <span class="org-variable-name">gr_name</span>;                <span class="org-comment-delimiter">/* </span><span class="org-comment">&#32452;&#21517;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">char</span>* <span class="org-variable-name">gr_passwd</span>;              <span class="org-comment-delimiter">/* </span><span class="org-comment">&#21152;&#23494;&#21475;&#20196;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">int</span> <span class="org-variable-name">gr_gid</span>;                   <span class="org-comment-delimiter">/* </span><span class="org-comment">&#32452;id</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">char</span>** <span class="org-variable-name">gr_mem</span>;                <span class="org-comment-delimiter">/* </span><span class="org-comment">&#32452;&#25104;&#21592;&#21517;&#31216;&#21015;&#34920;</span><span class="org-comment-delimiter"> */</span>
};
<span class="org-comment-delimiter">/* </span><span class="org-comment">&#19979;&#38754;&#19977;&#20010;&#20989;&#25968;&#29992;&#20110;&#36941;&#21382;group&#39033;</span><span class="org-comment-delimiter"> */</span>

<span class="org-comment-delimiter">/* </span><span class="org-comment">&#33509;&#26410;&#25171;&#24320;group&#25991;&#20214;&#21017;&#25171;&#24320;group&#25991;&#20214;,&#23558;&#35835;&#25351;&#38024;&#25918;&#21040;&#31532;&#19968;&#26465;&#35760;&#24405;</span><span class="org-comment-delimiter"> */</span>
<span class="org-type">void</span> <span class="org-function-name">setgrent</span>();
<span class="org-comment-delimiter">/* </span><span class="org-comment">&#33509;&#26410;&#25171;&#24320;group&#25991;&#20214;&#21017;&#25171;&#24320;group&#25991;&#20214;,&#35835;&#21462;&#19979;&#19968;&#26465;group&#39033;</span><span class="org-comment-delimiter">*/</span>
<span class="org-keyword">struct</span> <span class="org-type">group</span>* <span class="org-function-name">getgrent</span>();
<span class="org-comment-delimiter">/* </span><span class="org-comment">&#20851;&#38381;group&#25991;&#20214;</span><span class="org-comment-delimiter"> */</span>
<span class="org-type">void</span> <span class="org-function-name">endgrent</span>();
</pre>
</div>

<p>
但与passwd不同的是,UNIX具有附加组的概念. 为了获取和设置附加组ID,提供了下列三个函数:
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;grp.h&gt;</span>
<span class="org-preprocessor">#include</span> <span class="org-string">&lt;unistd.h&gt;</span>

<span class="org-comment-delimiter">/* </span><span class="org-comment">&#33719;&#21462;&#24403;&#21069;&#29992;&#25143;&#30340;&#38468;&#21152;&#32452;&#21015;&#34920;,&#36820;&#22238;&#29992;&#25143;&#38468;&#21152;&#32452;&#30340;&#20010;&#25968;,&#20986;&#38169;&#21017;&#36820;&#22238;-1</span><span class="org-comment-delimiter"> */</span>
<span class="org-type">int</span> <span class="org-function-name">getgroups</span>(<span class="org-type">int</span> <span class="org-variable-name">group_array_size</span>,<span class="org-type">gid_t</span> <span class="org-variable-name">group_size</span>[]);

<span class="org-comment-delimiter">/* </span><span class="org-comment">&#20026;&#24403;&#21069;&#36827;&#31243;&#35774;&#32622;&#38468;&#21152;&#32452;</span><span class="org-comment-delimiter"> */</span>
<span class="org-type">int</span> <span class="org-function-name">setgroups</span>(<span class="org-type">int</span> <span class="org-variable-name">group_array_size</span>,<span class="org-type">gid_t</span> <span class="org-variable-name">group_size</span>[]);

<span class="org-comment-delimiter">/* </span><span class="org-comment">&#20026;&#36827;&#31243;&#38468;&#21152;&#32452;&#35774;&#32622;&#20026;username&#30340;&#38468;&#21152;&#32452;</span><span class="org-comment-delimiter"> */</span>
<span class="org-type">int</span> <span class="org-function-name">initgroups</span>(<span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">username</span>,<span class="org-type">gid_t</span> <span class="org-variable-name">base_gid</span>);
</pre>
</div>
<ul class="org-ul">
<li>setgroups只可由超级用户调用,且参数group_array_size不能大于NGROUPS_MAX</li>
<li>initgroups函数会调用setgroups来设置进程的附加组,因此也只能由超级用户调用.</li>
</ul>
</div>
</div>


<div id="outline-container-org8671895" class="outline-2">
<h2 id="org8671895"><span class="section-number-2">4</span> 其他数据文件</h2>
<div class="outline-text-2" id="text-4">
<p>
对于hosts,networks,protocols,services等系统文件,UNIX也提供了与passwd类似的函数.
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">系统文件说明</th>
<th scope="col" class="org-left">数据路径</th>
<th scope="col" class="org-left">头文件</th>
<th scope="col" class="org-left">结构体</th>
<th scope="col" class="org-left">附加的关键字查找函数</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">主机</td>
<td class="org-left">/etc/hosts</td>
<td class="org-left">&lt;netdb.h&gt;</td>
<td class="org-left">hostent</td>
<td class="org-left">gethostbyname,gethostbyaddr</td>
</tr>

<tr>
<td class="org-left">网络</td>
<td class="org-left">/etc/networks</td>
<td class="org-left">&lt;netdb.h&gt;</td>
<td class="org-left">netent</td>
<td class="org-left">getnetbyname,getnetbyaddr</td>
</tr>

<tr>
<td class="org-left">协议</td>
<td class="org-left">/etc/protocols</td>
<td class="org-left">&lt;netdb.h&gt;</td>
<td class="org-left">protoent</td>
<td class="org-left">getprotobyname,getprotobynumber</td>
</tr>

<tr>
<td class="org-left">服务</td>
<td class="org-left">/etc/services</td>
<td class="org-left">&lt;netdb.h&gt;</td>
<td class="org-left">servent</td>
<td class="org-left">getservbyname,getservbyport</td>
</tr>
</tbody>
</table>

<p>
一般情况下,每个数据文件都会有三个函数:
</p>
<ul class="org-ul">
<li><p>
set函数
</p>

<p>
若尚未打开数据文件,则打开数据文件,并将读指针放到第一条记录处
</p></li>

<li><p>
get函数
</p>

<p>
若尚未打开数据文件,则打开数据文件,并读取下一条数据项.
</p>

<p>
<b>当到达文件尾端则返回空指针</b>
</p>

<p>
<b>大多数get函数返回指向一个静态结构的指针,如果要保存该内容,则需要复制它</b>
</p></li>

<li><p>
end函数
</p>

<p>
关闭响应数据文件.
</p></li>
</ul>
</div>

<div id="outline-container-org0a897c8" class="outline-3">
<h3 id="org0a897c8"><span class="section-number-3">4.1</span> hosts文件</h3>
<div class="outline-text-3" id="text-4-1">
<p>
本机信息存放在/etc/hosts中,可以通过调用gethostent查找本机主机信息
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;netdb.h&gt;</span>

<span class="org-comment-delimiter">/* </span><span class="org-comment">&#33719;&#21462;&#20027;&#26426;&#20449;&#24687;</span><span class="org-comment-delimiter"> */</span>
<span class="org-keyword">struct</span> <span class="org-type">hostent</span>* <span class="org-function-name">gethostent</span>();

<span class="org-keyword">struct</span> <span class="org-type">hostent</span>{
  <span class="org-type">char</span>* <span class="org-variable-name">h_name</span>;                 <span class="org-comment-delimiter">/* </span><span class="org-comment">&#20027;&#26426;&#21517;&#31216;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">char</span>** <span class="org-variable-name">h_aliases</span>;             <span class="org-comment-delimiter">/* </span><span class="org-comment">&#20027;&#26426;&#21035;&#21517;&#21015;&#34920;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">int</span> <span class="org-variable-name">h_addrtype</span>;               <span class="org-comment-delimiter">/* </span><span class="org-comment">&#22320;&#22336;&#31867;&#22411;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">int</span> <span class="org-variable-name">h_length</span>;                 <span class="org-comment-delimiter">/* </span><span class="org-comment">length in bytes of address</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">char</span>** <span class="org-variable-name">h_addr_list</span>;           <span class="org-comment-delimiter">/* </span><span class="org-comment">&#32593;&#32476;&#22320;&#22336;&#21015;&#34920;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-comment-delimiter">/* </span><span class="org-comment">&#20854;&#20182;&#25104;&#21592;</span><span class="org-comment-delimiter"> */</span>
};

<span class="org-comment-delimiter">/* </span><span class="org-comment">&#25171;&#24320;&#20027;&#26426;&#25991;&#20214;,&#37325;&#32622;&#35760;&#24405;&#25351;&#38024;</span><span class="org-comment-delimiter"> */</span>
<span class="org-type">void</span> <span class="org-function-name">sethostent</span>(<span class="org-type">int</span> <span class="org-variable-name">stayopen</span>);

<span class="org-comment-delimiter">/* </span><span class="org-comment">&#20851;&#38381;&#20027;&#26426;&#25991;&#20214;</span><span class="org-comment-delimiter"> */</span>
<span class="org-type">void</span> <span class="org-function-name">endhostent</span>();

<span class="org-keyword">struct</span> <span class="org-type">hostent</span>* <span class="org-function-name">gethostbyname</span>(<span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">name</span>);

<span class="org-comment-delimiter">/* </span><span class="org-comment">&#21442;&#25968;len&#20026;&#21442;&#25968;addr&#30340;&#38271;&#24230;,type&#34920;&#31034;&#26159;IPv4&#36824;&#26159;IPv6</span><span class="org-comment-delimiter"> */</span>
<span class="org-keyword">struct</span> <span class="org-type">hostent</span>* <span class="org-function-name">gethostbyaddr</span>(<span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">addr</span>,<span class="org-type">int</span> <span class="org-variable-name">len</span>,<span class="org-type">int</span> <span class="org-variable-name">type</span>);
</pre>
</div>
<ul class="org-ul">
<li><p>
gethostent返回/etc/hosts文件中的下一个条目, <b>若文件没打开,gethostent还会打开它</b>
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;unistd.h&gt;</span>
<span class="org-preprocessor">#include</span> <span class="org-string">&lt;netdb.h&gt;</span>
<span class="org-preprocessor">#include</span> <span class="org-string">&lt;stdio.h&gt;</span>
<span class="org-preprocessor">#include</span> <span class="org-string">&lt;netinet/in.h&gt;</span>
<span class="org-preprocessor">#include</span> <span class="org-string">&lt;arpa/inet.h&gt;</span>

<span class="org-type">void</span> <span class="org-function-name">show_hostent</span>(<span class="org-keyword">const</span> <span class="org-keyword">struct</span> <span class="org-type">hostent</span>* <span class="org-variable-name">h</span>)
{
  printf(<span class="org-string">"h_name=[%s]\n"</span>,h-&gt;h_name);
  <span class="org-type">int</span> <span class="org-variable-name">i</span> = 0;
  <span class="org-type">char</span>* <span class="org-variable-name">alias</span>=<span class="org-constant">NULL</span>;
  <span class="org-keyword">for</span>(alias = h-&gt;h_aliases[i];alias !=<span class="org-constant">NULL</span>;++i){
    printf(<span class="org-string">"h_alias=[%s]\n"</span>,alias);
  }
  printf(<span class="org-string">"h_addrtype=[%d]"</span>,h-&gt;h_addrtype);
  printf(<span class="org-string">"h_length=[%d]"</span>,h-&gt;h_length);
  <span class="org-comment-delimiter">/* </span><span class="org-comment">fflush(stdout);</span><span class="org-comment-delimiter"> */</span>
  <span class="org-comment-delimiter">/* </span><span class="org-comment">if(h-&gt;h_addrtype == AF_INET) {</span><span class="org-comment-delimiter"> */</span>
  <span class="org-comment-delimiter">/*   </span><span class="org-comment">for(i = 0;i &lt; h-&gt;h_length;++i){</span><span class="org-comment-delimiter"> */</span>
  <span class="org-comment-delimiter">/*     </span><span class="org-comment">struct in_addr** addresses = (struct in_addr**)h-&gt;h_addr_list;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-comment-delimiter">/*     </span><span class="org-comment">printf("h_addr=[%d]",addresses[i]-&gt;s_addr);</span><span class="org-comment-delimiter"> */</span>
  <span class="org-comment-delimiter">/*   </span><span class="org-comment">}</span><span class="org-comment-delimiter"> */</span>
  <span class="org-comment-delimiter">/* </span><span class="org-comment">}</span><span class="org-comment-delimiter"> */</span>
}

<span class="org-type">int</span> <span class="org-function-name">main</span>()
{
  <span class="org-keyword">struct</span> <span class="org-type">hostent</span>* <span class="org-variable-name">h</span> = gethostent();
  show_hostent(h);
  <span class="org-keyword">return</span> 0;
}

</pre>
</div></li>
<li>sethostent会打开文件并重置记录指针,参数stayopen为非0时,调用gethostent之后,文件将依然是打开的.</li>
<li>endhostent关闭主机文件.</li>
</ul>
</div>
</div>

<div id="outline-container-orga0a91df" class="outline-3">
<h3 id="orga0a91df"><span class="section-number-3">4.2</span> networks文件</h3>
<div class="outline-text-3" id="text-4-2">
<p>
我们使用以下函数获得网络名字和网络编号
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;netdb.h&gt;</span>

<span class="org-keyword">struct</span> <span class="org-type">netent</span>* <span class="org-function-name">getnetbyaddr</span>(<span class="org-type">uint32_t</span> <span class="org-variable-name">net</span>,<span class="org-type">int</span> <span class="org-variable-name">type</span>);

<span class="org-keyword">struct</span> <span class="org-type">netent</span>* <span class="org-function-name">getnetbyname</span>(<span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">name</span>);

<span class="org-keyword">struct</span> <span class="org-type">netent</span>* <span class="org-function-name">getnetent</span>();

<span class="org-type">void</span> <span class="org-function-name">setnetent</span>(<span class="org-type">int</span> <span class="org-variable-name">stayopen</span>);

<span class="org-type">void</span> <span class="org-function-name">endnetent</span>();

<span class="org-keyword">struct</span> <span class="org-type">netent</span>
{
  <span class="org-type">char</span>* <span class="org-variable-name">n_name</span>;                 <span class="org-comment-delimiter">/* </span><span class="org-comment">&#32593;&#32476;&#21517;&#31216;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">char</span>** <span class="org-variable-name">n_aliases</span>;             <span class="org-comment-delimiter">/* </span><span class="org-comment">&#32593;&#32476;&#21035;&#21517;&#21015;&#34920;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">int</span> <span class="org-variable-name">n_addrtype</span>;               <span class="org-comment-delimiter">/* </span><span class="org-comment">&#22320;&#22336;&#31867;&#22411;,&#22914;AF_INET</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">uint32_t</span> <span class="org-variable-name">n_net</span>;               <span class="org-comment-delimiter">/* </span><span class="org-comment">&#32593;&#32476;&#32534;&#21495;,&#25353;&#32593;&#32476;&#23383;&#33410;&#24207;&#36820;&#22238;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-comment-delimiter">/* </span><span class="org-comment">&#20854;&#20182;&#25104;&#21592;</span><span class="org-comment-delimiter"> */</span>
};
</pre>
</div>
</div>
</div>

<div id="outline-container-org1214833" class="outline-3">
<h3 id="org1214833"><span class="section-number-3">4.3</span> protocols文件</h3>
<div class="outline-text-3" id="text-4-3">
<p>
我们可以使用以下函数在协议名字和协议编号之间进行映射
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;netdb.h&gt;</span>

<span class="org-keyword">struct</span> <span class="org-type">protoent</span>* <span class="org-function-name">getprotobyname</span>(<span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">name</span>);

<span class="org-keyword">struct</span> <span class="org-type">protoent</span>* <span class="org-function-name">getprotobynumber</span>(<span class="org-type">int</span> <span class="org-variable-name">proto</span>);

<span class="org-keyword">struct</span> <span class="org-type">protoent</span>* <span class="org-function-name">getprotoent</span>();

<span class="org-type">void</span> <span class="org-function-name">setprotoent</span>(<span class="org-type">int</span> <span class="org-variable-name">stayopen</span>);

<span class="org-type">void</span> <span class="org-function-name">endprotoent</span>();

<span class="org-keyword">struct</span> <span class="org-type">protoent</span>
{
  <span class="org-type">char</span>* <span class="org-variable-name">p_name</span>;                 <span class="org-comment-delimiter">/* </span><span class="org-comment">&#21327;&#35758;&#21517;&#31216;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">char</span>** <span class="org-variable-name">p_aliases</span>;             <span class="org-comment-delimiter">/* </span><span class="org-comment">&#21327;&#35758;&#21035;&#21517;&#21015;&#34920;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">int</span> <span class="org-variable-name">p_proto</span>;                  <span class="org-comment-delimiter">/* </span><span class="org-comment">&#21327;&#35758;&#32534;&#21495;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-comment-delimiter">/* </span><span class="org-comment">&#20854;&#20182;&#25104;&#21592;</span><span class="org-comment-delimiter"> */</span>
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcf76e80" class="outline-3">
<h3 id="orgcf76e80"><span class="section-number-3">4.4</span> services文件</h3>
<div class="outline-text-3" id="text-4-4">
<p>
服务由地址的端口号部分表示,每个服务由一个唯一的总所周知的端口号来表示
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;netdb.h&gt;</span>

<span class="org-comment-delimiter">/* </span><span class="org-comment">proto&#25351;&#26126;&#20102;&#20351;&#29992;&#30340;&#32593;&#32476;&#21327;&#35758;</span><span class="org-comment-delimiter"> */</span>
<span class="org-keyword">struct</span> <span class="org-type">servent</span>* <span class="org-function-name">getservbyname</span>(<span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">name</span>,<span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">proto</span>);

<span class="org-keyword">struct</span> <span class="org-type">servent</span>* <span class="org-function-name">getservbyport</span>(<span class="org-type">int</span> <span class="org-variable-name">port</span>,<span class="org-keyword">const</span> <span class="org-type">char</span>* <span class="org-variable-name">proto</span>);

<span class="org-keyword">struct</span> <span class="org-type">getservent</span>();

<span class="org-type">void</span> <span class="org-function-name">setservent</span>(<span class="org-type">int</span> <span class="org-variable-name">stayopen</span>);

<span class="org-type">void</span> <span class="org-function-name">endservent</span>();

<span class="org-keyword">struct</span> <span class="org-type">servent</span>
{
  <span class="org-type">char</span>* <span class="org-variable-name">s_name</span>;                 <span class="org-comment-delimiter">/* </span><span class="org-comment">&#26381;&#21153;&#21517;&#31216;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">char</span>** <span class="org-variable-name">p_aliases</span>;             <span class="org-comment-delimiter">/* </span><span class="org-comment">&#21327;&#35758;&#21035;&#21517;&#21015;&#34920;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">int</span> <span class="org-variable-name">p_proto</span>;                  <span class="org-comment-delimiter">/* </span><span class="org-comment">&#26381;&#21153;&#20351;&#29992;&#30340;&#32593;&#32476;&#21327;&#35758;&#32534;&#21495;,&#22914;TCP,UDP&#31561;</span><span class="org-comment-delimiter"> */</span>
};
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgcc4f867" class="outline-2">
<h2 id="orgcc4f867"><span class="section-number-2">5</span> 登录账户记录</h2>
<div class="outline-text-2" id="text-5">
<p>
大多数UNIX系统都提供下面两个数据文件:
</p>
<dl class="org-dl">
<dt>utmp文件</dt><dd>记录当前登录进系统的各个用户</dd>
<dt>wtmp文件</dt><dd>跟踪各个登录和注销事件</dd>
</dl>

<p>
每次写入这两个文件的是包含以下结构的二进制记录:
</p>
<div class="org-src-container">
<pre class="src src-C"><span class="org-keyword">struct</span> <span class="org-type">utmp</span>{
  <span class="org-type">char</span> <span class="org-variable-name">ut_line</span>[8];              <span class="org-comment-delimiter">/* </span><span class="org-comment">tty&#32534;&#21495;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">char</span> <span class="org-variable-name">ut_name</span>[8];              <span class="org-comment-delimiter">/* </span><span class="org-comment">&#30331;&#24405;&#21517;,&#27880;&#38144;&#26102;&#20026;&#31354;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">long</span> <span class="org-variable-name">ut_time</span>;                 <span class="org-comment-delimiter">/* </span><span class="org-comment">&#30331;&#24405;/&#27880;&#38144;&#20107;&#20214;</span><span class="org-comment-delimiter"> */</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org1abbe0d" class="outline-2">
<h2 id="org1abbe0d"><span class="section-number-2">6</span> 系统标识</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-org333a86d" class="outline-3">
<h3 id="org333a86d"><span class="section-number-3">6.1</span> uname函数:获取当前主机与操作系统相关信息</h3>
<div class="outline-text-3" id="text-6-1">
<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;sys/utsname.h&gt;</span>

<span class="org-type">int</span> <span class="org-function-name">uname</span>(<span class="org-keyword">struct</span> <span class="org-type">utsname</span>* <span class="org-variable-name">name</span>);

<span class="org-keyword">struct</span> <span class="org-type">utsname</span>{
  <span class="org-type">char</span> <span class="org-variable-name">sysname</span>[];               <span class="org-comment-delimiter">/* </span><span class="org-comment">&#25805;&#20316;&#31995;&#32479;&#21517;&#31216;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">char</span> <span class="org-variable-name">nodename</span>[];              <span class="org-comment-delimiter">/* </span><span class="org-comment">&#33410;&#28857;&#21517;&#31216;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">char</span> <span class="org-variable-name">release</span>[];               <span class="org-comment-delimiter">/* </span><span class="org-comment">&#25805;&#20316;&#31995;&#32479;&#30340;&#21457;&#24067;&#22411;&#21495;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">char</span> <span class="org-variable-name">version</span>[];               <span class="org-comment-delimiter">/* </span><span class="org-comment">&#25805;&#20316;&#31995;&#32479;&#21457;&#24067;&#29256;&#26412;</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">char</span> <span class="org-variable-name">machine</span>[];               <span class="org-comment-delimiter">/* </span><span class="org-comment">&#30828;&#20214;&#31867;&#22411;</span><span class="org-comment-delimiter"> */</span>
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb4a5cf2" class="outline-3">
<h3 id="orgb4a5cf2"><span class="section-number-3">6.2</span> gethostname函数:只返回主机名</h3>
<div class="outline-text-3" id="text-6-2">
<div class="org-src-container">
<pre class="src src-C"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;unistd.h&gt;</span>

<span class="org-type">ing</span> <span class="org-function-name">gethostname</span>(<span class="org-type">char</span>* <span class="org-variable-name">name</span>,<span class="org-type">int</span> <span class="org-variable-name">bufsize</span>);
</pre>
</div>
<ul class="org-ul">
<li>最大主机名长度为HOST_NAME_MAX</li>
</ul>
</div>
</div>
</div>

</div>
</div>
<div>
  <div class="post-meta">
    <span title="post date" class="post-info">2015-05-16</span>
    <span title="last modification date" class="post-info">2016-10-24</span>
    <span title="tags" class="post-info">N/A</span>
    <span title="author" class="post-info">DarkSun</span>
  </div>
  <script src="../../../../../media/js/jquery-2.1.3.min.js"></script>
  <script src="../../../../../media/js/md5.min.js"></script>
  <section>
      <div id="gitalk-container"></div>
      <script type="text/javascript">
       var gitalk = new Gitalk({
           clientID: 'fdcb5d9da3f4acb4862c',
           clientSecret: 'dd0a16312a206782cb7669dcec5e96874ab48170',
           repo: 'lujun9972.github.com',
           owner: 'lujun9972',
           admin: ['lujun9972'],
           id: md5(location.pathname),      // Ensure uniqueness and length less than 50
           distractionFreeMode: false  // Facebook-like distraction free mode
       })
       gitalk.render('gitalk-container')
      </script>
  </section>
  <script src="../../../../../media/js/kdComment.js"></script>
      <script>
       var _hmt = _hmt || [];
       (function() {
           var hm = document.createElement("script");
           hm.src = "https://hm.baidu.com/hm.js?7bac4fd0247f69c27887e0d4e3aee41e";
           var s = document.getElementsByTagName("script")[0]; 
           s.parentNode.insertBefore(hm, s);
       })();
      </script>
  <div class="footer">
    <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 27.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
    <p>
      Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:travis &lt;at&gt; travis-job-9f55b4e9-ce45-4d2a-8881-2d80f237503d">DarkSun</a>
      &nbsp;&nbsp;-&nbsp;&nbsp;
      Powered by <a href="https://github.com/emacs-china/EGO" target="_blank">EGO</a><br/>
      Themed with <a href="https://github.com/kuangdash/emacs_love" target="_blank">emacs_love</a>
        <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="https://licensebuttons.net/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
      <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
    </p>
  </div>
    </div>

  </body>
</html>
