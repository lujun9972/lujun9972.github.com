<!DOCTYPE html>
<html lang="en">
<head>
  <title>使用lynis进行linux漏洞扫描 - 暗无天日</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="author" content="lujun9972" />
  <meta name="keywords" content="linux和它的小伙伴" />
  <style>
   #ds-thread #ds-reset .ds-comment-body p {color: #ffffff;}
   #disqus_thread a {color: #00ffff;}
  </style>
  <link rel="stylesheet" media="screen" href="../../../../../media/css/font.css" rel="stylesheet" type="text/css"/>
  <link rel="stylesheet" href="../../../../../media/css/main.css" type="text/css">
  <link rel="stylesheet" href="../../../../../media/css/org-src-fontify.css" type="text/css">
  <link rel="stylesheet" href="../../../../../media/css/kdComment.css" type="text/css">
  <script type="text/javascript"
          src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
</head>

  <body class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="../../../../../">暗无天日</a></h1>
    <p>=============&gt;随便,谢谢</p>
    <nav class="site-nav">
      <div class="menu-icon">
      </div>
      <ul class="trigger">
              <li><a href="../../../../../years/">Years</a></li>
              <li><a href="../../../../../tags/">Tags</a></li>
              <li><a href="../../../../../about/">About</a></li>
              <li><a href="https://github.com/lujun9972/lujun9972.github.com.git">Github</a></li>
              <li><a href="../../../../../rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="http://www.google.com/search">
        <input type="text" class="field" name="q" id="s" placeholder="Search">
        <input type="hidden" name="as_sitesearch" value="lujun9972.github.io">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">使用lynis进行linux漏洞扫描</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org7745dea">安装lynis</a></li>
<li><a href="#org9b02a3d">使用lynis进行主机扫描</a>
<ul>
<li><a href="#org72519bd">查看详细说明</a></li>
<li><a href="#orgf48fa91">查看日志文件</a></li>
</ul>
</li>
<li><a href="#org81a11b7">检查更新</a></li>
<li><a href="#org7401d03">自定义lynis安全审计策略</a></li>
</ul>
</div>
</div>
<p>
lynis 是一款运行在 Unix/Linux 平台上的基于主机的、开源的安全审计软件。
</p>

<div id="outline-container-org7745dea" class="outline-2">
<h2 id="org7745dea">安装lynis</h2>
<div class="outline-text-2" id="text-org7745dea">
<p>
在 archlinux 上可以直接通过 pacman 来安装
</p>
<div class="org-src-container">
<pre class="src src-shell">sudo pacman -S lynis --noconfirm
</pre>
</div>

<div class="org-src-container">
<pre class="src src-org">resolving dependencies...
looking for conflicting packages...

Packages (1) lynis-2.6.4-1

Total Installed Size:  1.35 MiB
Net Upgrade Size:      0.00 MiB

:: Proceed with installation? [Y/n] 
(0/1) checking keys in keyring                     [----------------------]   0%(1/1) checking keys in keyring                     [######################] 100%
(0/1) checking package integrity                   [----------------------]   0%(1/1) checking package integrity                   [######################] 100%
(0/1) loading package files                        [----------------------]   0%(1/1) loading package files                        [######################] 100%
(0/1) checking for file conflicts                  [----------------------]   0%(1/1) checking for file conflicts                  [######################] 100%
(0/1) checking available disk space                [----------------------]   0%(1/1) checking available disk space                [######################] 100%
:: Processing package changes...
(1/1) reinstalling lynis                           [----------------------]   0%(1/1) reinstalling lynis                           [######################] 100%
:: Running post-transaction hooks...
(1/2) Reloading system manager configuration...
(2/2) Arming ConditionNeedsUpdate...
</pre>
</div>
</div>
</div>

<div id="outline-container-org9b02a3d" class="outline-2">
<h2 id="org9b02a3d">使用lynis进行主机扫描</h2>
<div class="outline-text-2" id="text-org9b02a3d">
<p>
首先让我们不带任何参数运行 lynis, 这会列出 lynis 支持的那些参数
</p>
<pre class="example">
[lujun9972@T520 linux和它的小伙伴]$ lynis

[ Lynis 2.6.4 ]

################################################################################
  Lynis comes with ABSOLUTELY NO WARRANTY. This is free software, and you are
  welcome to redistribute it under the terms of the GNU General Public License.
  See the LICENSE file for details about using this software.

  2007-2018, CISOfy - https://cisofy.com/lynis/
  Enterprise support available (compliance, plugins, interface and tools)
################################################################################


[+] Initializing program
------------------------------------


  Usage: lynis command [options]


  Command:

    audit
        audit system                  : Perform local security scan
        audit system remote &lt;host&gt;    : Remote security scan
        audit dockerfile &lt;file&gt;       : Analyze Dockerfile

    show
        show                          : Show all commands
        show version                  : Show Lynis version
        show help                     : Show help

    update
        update info                   : Show update details


  Options:

    --no-log                          : Don't create a log file
    --pentest                         : Non-privileged scan (useful for pentest)
    --profile &lt;profile&gt;               : Scan the system with the given profile file
    --quick (-Q)                      : Quick mode, don't wait for user input

    Layout options
    --no-colors                       : Don't use colors in output
    --quiet (-q)                      : No output
    --reverse-colors                  : Optimize color display for light backgrounds

    Misc options
    --debug                           : Debug logging to screen
    --view-manpage (--man)            : View man page
    --verbose                         : Show more details on screen
    --version (-V)                    : Display version number and quit

    Enterprise options
    --plugindir &lt;path&gt;                : Define path of available plugins
    --upload                          : Upload data to central node

    More options available. Run '/usr/bin/lynis show options', or use the man page.

  No command provided. Exiting..
</pre>

<p>
从上面可以看出，使用 lynis 进行主机扫描很简单，只需要带上参数 <code>audit system</code> 即可。
Lynis在审计的过程中,会进行多种类似的测试,在审计过程中会将各种测试结果、调试信息、和对系统的加固建议都被写到 stdin 。
我们可以执行下面命令来跳过检查过程,直接截取最后的扫描建议来看。
</p>
<div class="org-src-container">
<pre class="src src-shell">sudo lynis audit system |sed <span class="org-string">'1,/Results/d'</span>
</pre>
</div>

<p>
lynis将扫描的内容分成几大类，可以通过 <code>show groups</code> 参数来获取类别
</p>
<div class="org-src-container">
<pre class="src src-shell">lynis show groups
</pre>
</div>

<div class="org-src-container">
<pre class="src src-org">accounting
authentication
banners
boot_services
containers
crypto
databases
dns
file_integrity
file_permissions
filesystems
firewalls
hardening
homedirs
insecure_services
kernel
kernel_hardening
ldap
logging
mac_frameworks
mail_messaging
malware
memory_processes
nameservices
networking
php
ports_packages
printers_spools
scheduling
shells
snmp
squid
ssh
storage
storage_nfs
system_integrity
time
tooling
usb
virtualization
webservers

</pre>
</div>

<p>
若指向扫描某几类的内容，则可以通过 <code>--tests-from-group</code> 参数来指定。
</p>

<p>
比如我只想扫描 shells 和 networking 方面的内容，则可以执行
</p>
<div class="org-src-container">
<pre class="src src-shell">sudo lynis --tests-from-group <span class="org-string">"shells networking"</span> --no-colors
</pre>
</div>

<div class="org-src-container">
<pre class="src src-org">
[ Lynis 2.6.4 ]

################################################################################
  Lynis comes with ABSOLUTELY NO WARRANTY. This is free software, and you are
  welcome to redistribute it under the terms of the GNU General Public License.
  See the LICENSE file for details about using this software.

  2007-2018, CISOfy - <span class="org-org-link"><a href="https://cisofy.com/lynis/">https://cisofy.com/lynis/</a></span>
  Enterprise support available (compliance, plugins, interface and tools)
################################################################################


[+] Initializing program
------------------------------------
&#27;[2C- Detecting OS... &#27;[41C [ DONE ]
&#27;[2C- Checking profiles...&#27;[37C [ DONE ]
&#27;[2C- Detecting language and localization&#27;[22C [ zh ]
&#27;[4CNotice: no language file found for 'zh' (tried: /usr/share/lynis/db/languages/zh)&#27;[0C

  ---------------------------------------------------
  Program version:           2.6.4
  Operating system:          Linux
  Operating system name:     Arch Linux
  Operating system version:  Rolling release
  Kernel version:            4.16.13
  Hardware platform:         x86_64
  Hostname:                  T520
  ---------------------------------------------------
  Profiles:                  /etc/lynis/default.prf
  Log file:                  /var/log/lynis.log
  Report file:               /var/log/lynis-report.dat
  Report version:            1.0
  Plugin directory:          /usr/share/lynis/plugins
  ---------------------------------------------------
  Auditor:                   [Not Specified]
  Language:                  zh
  Test category:             all
  Test group:                shells networking
  ---------------------------------------------------
&#27;[2C- Program update status... &#27;[32C [ NO UPDATE ]

[+] System Tools
------------------------------------
&#27;[2C- Scanning available tools...&#27;[30C
&#27;[2C- Checking system binaries...&#27;[30C

[+] Plugins (phase 1)
------------------------------------
&#27;[0CNote: plugins have more extensive tests and may take several minutes to complete&#27;[0C
&#27;[0C &#27;[0C
&#27;[2C- Plugins enabled&#27;[42C [ NONE ]

[+] Shells
------------------------------------
&#27;[2C- Checking shells from /etc/shells&#27;[25C
&#27;[4CResult: found 5 shells (valid shells: 5).&#27;[16C
&#27;[4C- Session timeout settings/tools&#27;[25C [ NONE ]
&#27;[2C- Checking default umask values&#27;[28C
&#27;[4C- Checking default umask in /etc/bash.bashrc&#27;[13C [ NONE ]
&#27;[4C- Checking default umask in /etc/profile&#27;[17C [ WEAK ]

[+] Networking
------------------------------------
&#27;[2C- Checking IPv6 configuration&#27;[30C [ ENABLED ]
&#27;[6CConfiguration method&#27;[35C [ AUTO ]
&#27;[6CIPv6 only&#27;[46C [ NO ]
&#27;[2C- Checking configured nameservers&#27;[26C
&#27;[4C- Testing nameservers&#27;[36C
&#27;[6CNameserver: 202.96.134.33&#27;[30C [ SKIPPED ]
&#27;[6CNameserver: 202.96.128.86&#27;[30C [ SKIPPED ]
&#27;[4C- Minimal of 2 responsive nameservers&#27;[20C [ SKIPPED ]
&#27;[2C- Getting listening ports (TCP/UDP)&#27;[24C [ DONE ]
&#27;[6C* Found 11 ports&#27;[39C
&#27;[2C- Checking status DHCP client&#27;[30C [ RUNNING ]
&#27;[2C- Checking for ARP monitoring software&#27;[21C [ NOT FOUND ]

[+] Custom Tests
------------------------------------
&#27;[2C- Running custom tests... &#27;[33C [ NONE ]

[+] Plugins (phase 2)
------------------------------------

<span class="org-org-verbatim">================================================================================</span>

  -[ Lynis 2.6.4 Results ]-

  Great, no warnings

  Suggestions (1):
  ----------------------------
  * Consider running ARP monitoring software (arpwatch,arpon) [NETW-3032] 
      <span class="org-org-link"><a href="https://cisofy.com/controls/NETW-3032/">https://cisofy.com/controls/NETW-3032/</a></span>

  Follow-up:
  ----------------------------
  - Show details of a test (lynis show details TEST-ID)
  - Check the logfile for all details (less /var/log/lynis.log)
  - Read security controls texts (<span class="org-org-link"><a href="https://cisofy.com">https://cisofy.com</a></span>)
  - Use --upload to upload data to central system (Lynis Enterprise users)

<span class="org-org-verbatim">================================================================================</span>

  Lynis security scan details:

  Hardening index : 33 [######              ]
  Tests performed : 13
  Plugins enabled : 0

  Components:
  - Firewall               [X]
  - Malware scanner        [X]

  Lynis Modules:
  - Compliance Status      [?]
  - Security Audit         [V]
  - Vulnerability Scan     [V]

  Files:
  - Test and debug information      : /var/log/lynis.log
  - Report data                     : /var/log/lynis-report.dat

<span class="org-org-verbatim">================================================================================</span>

  Lynis 2.6.4

  Auditing, system hardening, and compliance for UNIX-based systems
  (Linux, macOS, BSD, and others)

  2007-2018, CISOfy - <span class="org-org-link"><a href="https://cisofy.com/lynis/">https://cisofy.com/lynis/</a></span>
  Enterprise support available (compliance, plugins, interface and tools)

<span class="org-org-verbatim">================================================================================</span>

  [TIP]: Enhance Lynis audits by adding your settings to custom.prf (see /etc/lynis/default.prf for all settings)

</pre>
</div>
</div>
<div id="outline-container-org72519bd" class="outline-3">
<h3 id="org72519bd">查看详细说明</h3>
<div class="outline-text-3" id="text-org72519bd">
<p>
在查看审计结果时,你可以通过 <code>show details</code> 参数来获取关于某条警告/建议的详细说明。其对应的命令形式为:
</p>

<div class="org-src-container">
<pre class="src src-shell">lynis show details ${<span class="org-variable-name">test_id</span>}
</pre>
</div>

<p>
比如，上面图中有一个建议
</p>
<pre class="example">
* Consider running ARP monitoring software (arpwatch,arpon) [NETW-3032] 
</pre>

<p>
我们可以运行命令：
</p>

<div class="org-src-container">
<pre class="src src-shell">sudo lynis show details NETW-3032 
</pre>
</div>

<div class="org-src-container">
<pre class="src src-org">2018-06-08 18:18:01 Performing test ID NETW-3032 (Checking for ARP monitoring software)
2018-06-08 18:18:01 IsRunning: process 'arpwatch' not found
2018-06-08 18:18:01 IsRunning: process 'arpon' not found
2018-06-08 18:18:01 Suggestion: Consider running ARP monitoring software (arpwatch,arpon) [test:NETW-3032] [details:-] [solution:-]
2018-06-08 18:18:01 Checking permissions of /usr/share/lynis/include/tests_printers_spools
2018-06-08 18:18:01 File permissions are OK
2018-06-08 18:18:01 <span class="org-org-verbatim">===</span>---------------------------------------------------------------<span class="org-org-verbatim">===</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-orgf48fa91" class="outline-3">
<h3 id="orgf48fa91">查看日志文件</h3>
<div class="outline-text-3" id="text-orgf48fa91">
<p>
lynis在审计完成后会将详细的信息记录在 <code>/var/log/lynis.log</code> 中.
</p>
<div class="org-src-container">
<pre class="src src-shell">sudo tail /var/log/lynis.log
</pre>
</div>

<div class="org-src-container">
<pre class="src src-org">2018-06-08 17:59:46 <span class="org-org-verbatim">================================================================================</span>
2018-06-08 17:59:46 Lynis 2.6.4
2018-06-08 17:59:46 2007-2018, CISOfy - <span class="org-org-link"><a href="https://cisofy.com/lynis/">https://cisofy.com/lynis/</a></span>
2018-06-08 17:59:46 Enterprise support available (compliance, plugins, interface and tools)
2018-06-08 17:59:46 Program ended successfully
2018-06-08 17:59:46 <span class="org-org-verbatim">================================================================================</span>
2018-06-08 17:59:46 PID file removed (/var/run/lynis.pid)
2018-06-08 17:59:46 Temporary files:  /tmp/lynis.sGxCR0hSPz
2018-06-08 17:59:46 Action: removing temporary file /tmp/lynis.sGxCR0hSPz
2018-06-08 17:59:46 Lynis ended successfully.
</pre>
</div>

<p>
同时将报告数据被保存到 <code>/var/log/lynis-report.dat</code> 中.
</p>
<div class="org-src-container">
<pre class="src src-shell">sudo tail /var/log/lynis-report.dat
</pre>
</div>

<div class="org-src-container">
<pre class="src src-org">network_listen_port[]=[::ffff:14.120.31.247]:51224
suggestion[]=NETW-3032|Consider running ARP monitoring software (arpwatch,arpon)|-|-|
dhcp_client_running=1
arpwatch_running=0
lynis_tests_done=13
report_datetime_end=2018-06-08 17:59:46
hardening_index=33
tests_executed=NETW-3032|NETW-3030|NETW-3012|NETW-3008|NETW-3006|NETW-3004|NETW-2705|NETW-2704|NETW-2600|SHLL-6230|SHLL-6220|SHLL-6211|CORE-1000|
tests_skipped=NETW-3028|NETW-3015|NETW-3014|NETW-3001|SHLL-6202|
finish=true
</pre>
</div>

<p>
另外需要注意的是，每次审计都会覆盖原日志文件.
</p>
</div>
</div>
</div>

<div id="outline-container-org81a11b7" class="outline-2">
<h2 id="org81a11b7">检查更新</h2>
<div class="outline-text-2" id="text-org81a11b7">
<p>
审计软件需要随时进行更新从而得到最新的建议和信息，我们可以使用 <code>update info</code> 参数来检查更新:
</p>
<div class="org-src-container">
<pre class="src src-shell">lynis update info --no-colors
</pre>
</div>

<div class="org-src-container">
<pre class="src src-org">
 <span class="org-org-verbatim">== &#27;[1;37mLynis&#27;[0m ==</span>

  Version            : 2.6.4
  Status             : &#27;[1;32mUp-to-date&#27;[0m
  Release date       : 2018-05-02
  Update location    : <span class="org-org-link"><a href="https://cisofy.com/lynis/">https://cisofy.com/lynis/</a></span>


2007-2018, CISOfy - <span class="org-org-link"><a href="https://cisofy.com/lynis/">https://cisofy.com/lynis/</a></span>

</pre>
</div>
</div>
</div>

<div id="outline-container-org7401d03" class="outline-2">
<h2 id="org7401d03">自定义lynis安全审计策略</h2>
<div class="outline-text-2" id="text-org7401d03">
<p>
lynis的配置信息以 <code>.prf</code> 文件的格式保存在 <code>/etc/lynis</code> 目录中。
其中，默认lynis自带一个名为 <code>default.prf</code> 的默认配置文件。
</p>

<p>
不过我们无需直接修改这个默认的配置文件，只需要新增一个 <code>custom.prf</code> 文件将自定义的信息加入其中就可以了。
</p>

<p>
关于配置文件中各配置项的意义，在 <code>default.prf</code> 中都有相应的注释说明,这里就不详述了。
</p>

<p>
想了解lynis的更多信息，可以访问<a href="https://cisofy.com/documentation/lynis/">它的官网.</a>
</p>
</div>
</div>

</div>
</div>
<div>
  <div class="post-meta">
    <span title="post date" class="post-info">2018-06-08</span>
    <span title="last modification date" class="post-info">2018-06-08</span>
    <span title="tags" class="post-info"><a href="../../../../../tags/linux和它的小伙伴">linux和它的小伙伴</a></span>
    <span title="author" class="post-info">lujun9972</span>
  </div>
  <script src="../../../../../media/js/jquery-2.1.3.min.js"></script>
  <script src="../../../../../media/js/md5.min.js"></script>
  <section>
      <div id="gitalk-container"></div>
      <script type="text/javascript">
       var gitalk = new Gitalk({
           clientID: 'fdcb5d9da3f4acb4862c',
           clientSecret: 'dd0a16312a206782cb7669dcec5e96874ab48170',
           repo: 'lujun9972.github.com',
           owner: 'lujun9972',
           admin: ['lujun9972'],
           id: md5(location.pathname),      // Ensure uniqueness and length less than 50
           distractionFreeMode: false  // Facebook-like distraction free mode
       })
       gitalk.render('gitalk-container')
      </script>
  </section>
  <script src="../../../../../media/js/kdComment.js"></script>
      <script>
       var _hmt = _hmt || [];
       (function() {
           var hm = document.createElement("script");
           hm.src = "https://hm.baidu.com/hm.js?7bac4fd0247f69c27887e0d4e3aee41e";
           var s = document.getElementsByTagName("script")[0]; 
           s.parentNode.insertBefore(hm, s);
       })();
      </script>
  <div class="footer">
    <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 27.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
    <p>
      Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:travis &lt;at&gt; travis-job-adabab64-65f3-4ed4-bd6c-a1638c380b0d">lujun9972</a>
      &nbsp;&nbsp;-&nbsp;&nbsp;
      Powered by <a href="https://github.com/emacs-china/EGO" target="_blank">EGO</a><br/>
      Themed with <a href="https://github.com/kuangdash/emacs_love" target="_blank">emacs_love</a>
        <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="https://licensebuttons.net/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
      <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
    </p>
  </div>
    </div>

  </body>
</html>
