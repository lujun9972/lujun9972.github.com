<!DOCTYPE html>
<html lang="en">
<head>
  <title>通过管道对接的进程被13号信号所杀 - 暗无天日</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="author" content="lujun9972" />
  <meta name="keywords" content="linux和它的小伙伴" />
  <style>
   #ds-thread #ds-reset .ds-comment-body p {color: #ffffff;}
   #disqus_thread a {color: #00ffff;}
  </style>
  <link rel="stylesheet" media="screen" href="../../../../../media/css/font.css" rel="stylesheet" type="text/css"/>
  <link rel="stylesheet" href="../../../../../media/css/main.css" type="text/css">
  <link rel="stylesheet" href="../../../../../media/css/org-src-fontify.css" type="text/css">
  <link rel="stylesheet" href="../../../../../media/css/kdComment.css" type="text/css">
  <script type="text/javascript"
          src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
</head>

  <body class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="../../../../../">暗无天日</a></h1>
    <p>=============&gt;随便,谢谢</p>
    <nav class="site-nav">
      <div class="menu-icon">
      </div>
      <ul class="trigger">
              <li><a href="../../../../../years/">Years</a></li>
              <li><a href="../../../../../tags/">Tags</a></li>
              <li><a href="../../../../../about/">About</a></li>
              <li><a href="https://github.com/lujun9972/lujun9972.github.com.git">Github</a></li>
              <li><a href="../../../../../rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="http://www.google.com/search">
        <input type="text" class="field" name="q" id="s" placeholder="Search">
        <input type="hidden" name="as_sitesearch" value="lujun9972.github.io">
    </form>
    <img class="avatar" src="https://avatar.csdnimg.cn/6/2/4/1_lujun9972.jpg" />
  </header>
</div>

<div>
<div class="post">
<h1 class="title">通过管道对接的进程被13号信号所杀</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgfe96a0d">症状</a></li>
<li><a href="#orga54b4fc">原因</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgfe96a0d" class="outline-2">
<h2 id="orgfe96a0d">症状</h2>
<div class="outline-text-2" id="text-orgfe96a0d">

<div class="figure">
<p><img src="../../../../../assets/blog/2018/12/09/通过管道对接的进程被13号信号所杀/process_in_pipe_kill_by_signal_13.png" alt="process_in_pipe_kill_by_signal_13.png" />
</p>
</div>

<p>
当将xargs的内容通过管道传递给其他进程处理时，有时会出现进程被信号13所杀的提示，但是整个命令的返回值为 0
</p>
</div>
</div>

<div id="outline-container-orga54b4fc" class="outline-2">
<h2 id="orga54b4fc">原因</h2>
<div class="outline-text-2" id="text-orga54b4fc">
<p>
通过 <code>kill -l</code> 我们可以查到信号13是 <code>SIGPIPE</code>:
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-builtin">kill</span> -l
</pre>
</div>

<div class="org-src-container">
<pre class="src src-org"> 1) SIGHUP       2) SIGINT       3) SIGQUIT      4) SIGILL       5) SIGTRAP
 6) SIGABRT      7) SIGBUS       8) SIGFPE       9) SIGKILL     10) SIGUSR1
11) SIGSEGV     12) SIGUSR2     13) SIGPIPE     14) SIGALRM     15) SIGTERM
16) SIGSTKFLT   17) SIGCHLD     18) SIGCONT     19) SIGSTOP     20) SIGTSTP
21) SIGTTIN     22) SIGTTOU     23) SIGURG      24) SIGXCPU     25) SIGXFSZ
26) SIGVTALRM   27) SIGPROF     28) SIGWINCH    29) SIGIO       30) SIGPWR
31) SIGSYS      34) SIGRTMIN    35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3
38) SIGRTMIN+4  39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8
43) SIGRTMIN+9  44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12 47) SIGRTMIN+13
48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14 51) SIGRTMAX-13 52) SIGRTMAX-12
53) SIGRTMAX-11 54) SIGRTMAX-10 55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7
58) SIGRTMAX-6  59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2
63) SIGRTMAX-1  64) SIGRTMAX    
</pre>
</div>

<p>
通过 <code>man signal.h</code> 我们可以查到 <code>SIGPIPE</code> 表示应用 <code>往无人读取的管道写入数据</code>.
</p>
<div class="org-src-container">
<pre class="src src-shell">man signal.h |grep SIGPIPE
</pre>
</div>

<div class="org-src-container">
<pre class="src src-org">&#9474;SIGPIPE   &#9474;       T        &#9474; Write on a pipe with no one to read it.            &#9474;
</pre>
</div>

<p>
所以，出现该提示的原因是, <code>xargs</code> 逐个地执行 <code>cat</code> 命令，并将内容传递给 <code>head</code> 命令。
</p>

<p>
<code>head</code> 命令在读取完第一次 <code>cat</code> 的内容并将第一行的内容输出后关闭了管道的读取端，
而 <code>xargs</code> 会继续执行下一个 <code>cat</code> 命令，cat命令的输出写入管道时就会发现管道的读取端已经被管理，从而引发 <code>SIGPIPE</code>.
</p>

<p>
而由于整个job的返回值是由管道最后一条命令的返回值决定的，因此返回值为0,但是当你检查 <code>PIPESTATUS[1]</code> 时就会发现有问题了:
</p>
<div class="org-src-container">
<pre class="src src-shell">find ./ -name <span class="org-string">"*.org"</span> |xargs -I{} cat <span class="org-string">"{}"</span> |head -n 1
<span class="org-builtin">echo</span> 0:${<span class="org-variable-name">PIPESTATUS</span>[0]} 1:${<span class="org-variable-name">PIPESTATUS</span>[1]} 2:${<span class="org-variable-name">PIPESTATUS</span>[2]}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-org"><span class="org-org-document-info-keyword">#+TITLE:</span> <span class="org-org-document-title">AwesomeWM&#20013;&#30340;client</span>
0:0 1:123 2:0
</pre>
</div>
</div>
</div>

</div>
</div>
<div>
  <div class="post-meta">
    <span title="post date" class="post-info">2018-12-09</span>
    <span title="last modification date" class="post-info">2018-12-09</span>
    <span title="tags" class="post-info"><a href="../../../../../tags/linux和它的小伙伴">linux和它的小伙伴</a></span>
    <span title="author" class="post-info">lujun9972</span>
  </div>
  <script src="../../../../../media/js/jquery-2.1.3.min.js"></script>
  <script src="../../../../../media/js/md5.min.js"></script>
  <section>
      <div id="gitalk-container"></div>
      <script type="text/javascript">
       var gitalk = new Gitalk({
           clientID: 'fdcb5d9da3f4acb4862c',
           clientSecret: 'dd0a16312a206782cb7669dcec5e96874ab48170',
           repo: 'lujun9972.github.com',
           owner: 'lujun9972',
           admin: ['lujun9972'],
           id: md5(location.pathname),      // Ensure uniqueness and length less than 50
           distractionFreeMode: false  // Facebook-like distraction free mode
       })
       gitalk.render('gitalk-container')
      </script>
  </section>
  <script src="../../../../../media/js/kdComment.js"></script>
      <script>
       var _hmt = _hmt || [];
       (function() {
           var hm = document.createElement("script");
           hm.src = "https://hm.baidu.com/hm.js?7bac4fd0247f69c27887e0d4e3aee41e";
           var s = document.getElementsByTagName("script")[0]; 
           s.parentNode.insertBefore(hm, s);
       })();
      </script>
  <div class="footer">
    <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 27.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
    <p>
      Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:travis &lt;at&gt; travis-job-b2090423-a1f3-4f7b-b7d2-ed6ed517ce4a">lujun9972</a>
      &nbsp;&nbsp;-&nbsp;&nbsp;
      Powered by <a href="https://github.com/emacs-china/EGO" target="_blank">EGO</a><br/>
      Themed with <a href="https://github.com/kuangdash/emacs_love" target="_blank">emacs_love</a>
        <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="https://licensebuttons.net/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
      <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
    </p>
  </div>
    </div>

  </body>
</html>
