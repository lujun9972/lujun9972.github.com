<!DOCTYPE html>
<html lang="en">
<head>
  <title>使用ping命令来探测目标主机的操作系统类型 - 暗无天日</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="author" content="lujun9972" />
  <meta name="keywords" content="linux和它的小伙伴" />
  <style>
   #ds-thread #ds-reset .ds-comment-body p {color: #ffffff;}
   #disqus_thread a {color: #00ffff;}
  </style>
  <link rel="stylesheet" media="screen" href="/media/css/font.css" rel="stylesheet" type="text/css"/>
  <link rel="stylesheet" href="/media/css/main.css" type="text/css">
  <link rel="stylesheet" href="/media/css/kdComment.css" type="text/css">
  <script type="text/javascript"
          src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
</head>

  <body class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="/">暗无天日</a></h1>
    <p>=============&gt;随便,谢谢</p>
    <nav class="site-nav">
      <div class="menu-icon">
      </div>
      <ul class="trigger">
              <li><a href="/years/">Years</a></li>
              <li><a href="/authors/">Authors</a></li>
              <li><a href="/tags/">Tags</a></li>
              <li><a href="/about/">About</a></li>
              <li><a href="https://github.com/lujun9972/lujun9972.github.com">Github</a></li>
              <li><a href="/rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="http://www.google.com/search">
        <input type="text" class="field" name="q" id="s" placeholder="Search">
        <input type="hidden" name="as_sitesearch" value="lujun9972.github.io">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">使用ping命令来探测目标主机的操作系统类型</h1>
<p>
从 <a href="http://subinsb.com/default-device-ttl-values/">http://subinsb.com/default-device-ttl-values/</a> 里学到的
</p>

<p>
原来不同的操作系统默认的TTL（Time To Live）值是不同的，因此通过ping命令返回的ttl值加上traceroute获得的跳转节点数就能算出目标节点设置的TTL数，从而推测出目标节点的操作系统类型。
</p>

<p>
比如，我们要探测 <code>sachachua.com</code> 的操作系统类型，可以这么做:
</p>

<ol class="org-ol">
<li><p>
先用 <code>traceroute</code> 确定跳转数
</p>

<div class="org-src-container">
<pre class="src src-shell">traceroute sachachua.com
</pre>
</div>

<p>
结果为:
</p>
<div class="org-src-container">
<pre class="src src-org">traceroute to sachachua.com (104.28.7.65), 30 hops max, 60 byte packets
 1  _gateway (192.4.4.4)  1.493 ms  1.857 ms  1.785 ms
 2  * * *
 3  192.168.254.254 (192.168.254.254)  3.066 ms  3.508 ms  4.061 ms
 4  61.142.7.17 (61.142.7.17)  21.018 ms  21.446 ms  21.389 ms
 5  113.98.5.221 (113.98.5.221)  4.585 ms 113.98.5.217 (113.98.5.217)  6.898 ms 113.98.5.221 (113.98.5.221)  5.993 ms
 6  113.98.22.25 (113.98.22.25)  5.033 ms  3.565 ms 113.98.22.33 (113.98.22.33)  10.527 ms
 7  * * *
 8  113.98.37.37 (113.98.37.37)  27.135 ms 113.98.37.29 (113.98.37.29)  17.216 ms 113.98.37.33 (113.98.37.33)  10.132 ms
 9  202.97.66.166 (202.97.66.166)  9.187 ms *  9.839 ms
10  202.97.60.42 (202.97.60.42)  12.112 ms 202.97.91.145 (202.97.91.145)  9.883 ms  9.838 ms
11  202.97.22.122 (202.97.22.122)  159.378 ms 202.97.58.130 (202.97.58.130)  238.142 ms 202.97.27.238 (202.97.27.238)  159.718 ms
12  202.97.50.58 (202.97.50.58)  167.309 ms  177.650 ms  176.709 ms
13  218.30.53.214 (218.30.53.214)  241.310 ms  240.190 ms  239.304 ms
14  104.28.7.65 (104.28.7.65)  199.621 ms  176.317 ms  198.775 ms
</pre>
</div>

<p>
从中可以看到，从本地到目标主机一共经过了 <code>14-1=13</code> 跳
</p></li>

<li><p>
ping 之
</p>

<div class="org-src-container">
<pre class="src src-shell">ping -c <span style="color: #a45bad;">4</span> sachachua.com
</pre>
</div>

<p>
结果为:
</p>
<div class="org-src-container">
<pre class="src src-org">PING sachachua.com (104.28.7.65) 56(84) bytes of data.
64 bytes from 104.28.7.65 (104.28.7.65): icmp_seq=1 ttl=51 time=159 ms
64 bytes from 104.28.7.65 (104.28.7.65): icmp_seq=2 ttl=51 time=159 ms
64 bytes from 104.28.7.65 (104.28.7.65): icmp_seq=3 ttl=51 time=177 ms
64 bytes from 104.28.7.65 (104.28.7.65): icmp_seq=4 ttl=51 time=159 ms

--- sachachua.com ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3002ms
rtt min/avg/max/mdev = 159.164/163.926/177.276/7.720 ms
</pre>
</div>

<p>
最终可以算出，目标主机设置的TTL为 <code>51+13=64</code>
</p></li>

<li><p>
查表
</p>

<p>
下面这张表是不同设备/操作系统默认TTL值的明细表：
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Device / OS</th>
<th scope="col" class="org-left">Version</th>
<th scope="col" class="org-left">Protocol</th>
<th scope="col" class="org-right">TTL</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">AIX</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">TCP</td>
<td class="org-right">60</td>
</tr>

<tr>
<td class="org-left">AIX</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">UDP</td>
<td class="org-right">30</td>
</tr>

<tr>
<td class="org-left">AIX</td>
<td class="org-left">3.2, 4.1</td>
<td class="org-left">ICMP</td>
<td class="org-right">255</td>
</tr>

<tr>
<td class="org-left">BSDI</td>
<td class="org-left">BSD/OS 3.1 and 4.0</td>
<td class="org-left">ICMP</td>
<td class="org-right">255</td>
</tr>

<tr>
<td class="org-left">Compa</td>
<td class="org-left">Tru64 v5.0</td>
<td class="org-left">ICMP</td>
<td class="org-right">64</td>
</tr>

<tr>
<td class="org-left">Cisco</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">ICMP</td>
<td class="org-right">254</td>
</tr>

<tr>
<td class="org-left">DEC Pathworks</td>
<td class="org-left">V5</td>
<td class="org-left">TCP and UDP</td>
<td class="org-right">30</td>
</tr>

<tr>
<td class="org-left">Foundry</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">ICMP</td>
<td class="org-right">64</td>
</tr>

<tr>
<td class="org-left">FreeBSD</td>
<td class="org-left">2.1R</td>
<td class="org-left">TCP and UDP</td>
<td class="org-right">64</td>
</tr>

<tr>
<td class="org-left">FreeBSD</td>
<td class="org-left">3.4, 4.0</td>
<td class="org-left">ICMP</td>
<td class="org-right">255</td>
</tr>

<tr>
<td class="org-left">FreeBSD</td>
<td class="org-left">5</td>
<td class="org-left">ICMP</td>
<td class="org-right">64</td>
</tr>

<tr>
<td class="org-left">HP-UX</td>
<td class="org-left">9.0x</td>
<td class="org-left">TCP and UDP</td>
<td class="org-right">30</td>
</tr>

<tr>
<td class="org-left">HP-UX</td>
<td class="org-left">10.01</td>
<td class="org-left">TCP and UDP</td>
<td class="org-right">64</td>
</tr>

<tr>
<td class="org-left">HP-UX</td>
<td class="org-left">10.2</td>
<td class="org-left">ICMP</td>
<td class="org-right">255</td>
</tr>

<tr>
<td class="org-left">HP-UX</td>
<td class="org-left">11</td>
<td class="org-left">ICMP</td>
<td class="org-right">255</td>
</tr>

<tr>
<td class="org-left">HP-UX</td>
<td class="org-left">11</td>
<td class="org-left">TCP</td>
<td class="org-right">64</td>
</tr>

<tr>
<td class="org-left">Irix</td>
<td class="org-left">5.3</td>
<td class="org-left">TCP and UDP</td>
<td class="org-right">60</td>
</tr>

<tr>
<td class="org-left">Irix</td>
<td class="org-left">6.x</td>
<td class="org-left">TCP and UDP</td>
<td class="org-right">60</td>
</tr>

<tr>
<td class="org-left">Irix</td>
<td class="org-left">6.5.3, 6.5.8</td>
<td class="org-left">ICMP</td>
<td class="org-right">255</td>
</tr>

<tr>
<td class="org-left">juniper</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">ICMP</td>
<td class="org-right">64</td>
</tr>

<tr>
<td class="org-left">MPE/IX (HP)</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">ICMP</td>
<td class="org-right">200</td>
</tr>

<tr>
<td class="org-left">Linux</td>
<td class="org-left">2.0.x kernel</td>
<td class="org-left">ICMP</td>
<td class="org-right">64</td>
</tr>

<tr>
<td class="org-left">Linux</td>
<td class="org-left">2.2.14 kernel</td>
<td class="org-left">ICMP</td>
<td class="org-right">255</td>
</tr>

<tr>
<td class="org-left">Linux</td>
<td class="org-left">2.4 kernel</td>
<td class="org-left">ICMP</td>
<td class="org-right">255</td>
</tr>

<tr>
<td class="org-left">Linux</td>
<td class="org-left">Red Hat 9</td>
<td class="org-left">ICMP and TCP</td>
<td class="org-right">64</td>
</tr>

<tr>
<td class="org-left">MacOS/MacTCP</td>
<td class="org-left">2.0.x</td>
<td class="org-left">TCP and UDP</td>
<td class="org-right">60</td>
</tr>

<tr>
<td class="org-left">MacOS/MacTCP</td>
<td class="org-left">X (10.5.6)</td>
<td class="org-left">ICMP/TCP/UDP</td>
<td class="org-right">64</td>
</tr>

<tr>
<td class="org-left">NetBSD</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">ICMP</td>
<td class="org-right">255</td>
</tr>

<tr>
<td class="org-left">Netgear FVG318</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">ICMP and UDP</td>
<td class="org-right">64</td>
</tr>

<tr>
<td class="org-left">OpenBSD</td>
<td class="org-left">2.6 &amp; 2.7</td>
<td class="org-left">ICMP</td>
<td class="org-right">255</td>
</tr>

<tr>
<td class="org-left">OpenVMS</td>
<td class="org-left">07.01.2002</td>
<td class="org-left">ICMP</td>
<td class="org-right">255</td>
</tr>

<tr>
<td class="org-left">OS/2</td>
<td class="org-left">TCP/IP 3.0</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">64</td>
</tr>

<tr>
<td class="org-left">OSF/1</td>
<td class="org-left">V3.2A</td>
<td class="org-left">TCP</td>
<td class="org-right">60</td>
</tr>

<tr>
<td class="org-left">OSF/1</td>
<td class="org-left">V3.2A</td>
<td class="org-left">UDP</td>
<td class="org-right">30</td>
</tr>

<tr>
<td class="org-left">Solaris</td>
<td class="org-left">2.5.1, 2.6, 2.7, 2.8</td>
<td class="org-left">ICMP</td>
<td class="org-right">255</td>
</tr>

<tr>
<td class="org-left">Solaris</td>
<td class="org-left">2.8</td>
<td class="org-left">TCP</td>
<td class="org-right">64</td>
</tr>

<tr>
<td class="org-left">Stratus</td>
<td class="org-left">TCP_OS</td>
<td class="org-left">ICMP</td>
<td class="org-right">255</td>
</tr>

<tr>
<td class="org-left">Stratus</td>
<td class="org-left">TCP_OS (14.2-)</td>
<td class="org-left">TCP and UDP</td>
<td class="org-right">30</td>
</tr>

<tr>
<td class="org-left">Stratus</td>
<td class="org-left">TCP_OS (14.3+)</td>
<td class="org-left">TCP and UDP</td>
<td class="org-right">64</td>
</tr>

<tr>
<td class="org-left">Stratus</td>
<td class="org-left">STCP</td>
<td class="org-left">ICMP/TCP/UDP</td>
<td class="org-right">60</td>
</tr>

<tr>
<td class="org-left">SunOS</td>
<td class="org-left">4.1.3/4.1.4</td>
<td class="org-left">TCP and UDP</td>
<td class="org-right">60</td>
</tr>

<tr>
<td class="org-left">SunOS</td>
<td class="org-left">5.7</td>
<td class="org-left">ICMP and TCP</td>
<td class="org-right">255</td>
</tr>

<tr>
<td class="org-left">Ultrix</td>
<td class="org-left">V4.1/V4.2A</td>
<td class="org-left">TCP</td>
<td class="org-right">60</td>
</tr>

<tr>
<td class="org-left">Ultrix</td>
<td class="org-left">V4.1/V4.2A</td>
<td class="org-left">UDP</td>
<td class="org-right">30</td>
</tr>

<tr>
<td class="org-left">Ultrix</td>
<td class="org-left">V4.2 – 4.5</td>
<td class="org-left">ICMP</td>
<td class="org-right">255</td>
</tr>

<tr>
<td class="org-left">VMS/Multinet</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">TCP and UDP</td>
<td class="org-right">64</td>
</tr>

<tr>
<td class="org-left">VMS/TCPware</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">TCP</td>
<td class="org-right">60</td>
</tr>

<tr>
<td class="org-left">VMS/TCPware</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">UDP</td>
<td class="org-right">64</td>
</tr>

<tr>
<td class="org-left">VMS/Wollongong</td>
<td class="org-left">1.1.1.1</td>
<td class="org-left">TCP</td>
<td class="org-right">128</td>
</tr>

<tr>
<td class="org-left">VMS/Wollongong</td>
<td class="org-left">1.1.1.1</td>
<td class="org-left">UDP</td>
<td class="org-right">30</td>
</tr>

<tr>
<td class="org-left">VMS/UCX</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">TCP and UDP</td>
<td class="org-right">128</td>
</tr>

<tr>
<td class="org-left">Windows</td>
<td class="org-left">for Workgroups</td>
<td class="org-left">TCP and UDP</td>
<td class="org-right">32</td>
</tr>

<tr>
<td class="org-left">Windows</td>
<td class="org-left">95</td>
<td class="org-left">TCP and UDP</td>
<td class="org-right">32</td>
</tr>

<tr>
<td class="org-left">Windows</td>
<td class="org-left">98</td>
<td class="org-left">ICMP</td>
<td class="org-right">32</td>
</tr>

<tr>
<td class="org-left">Windows</td>
<td class="org-left">98, 98 SE</td>
<td class="org-left">ICMP</td>
<td class="org-right">128</td>
</tr>

<tr>
<td class="org-left">Windows</td>
<td class="org-left">98</td>
<td class="org-left">TCP</td>
<td class="org-right">128</td>
</tr>

<tr>
<td class="org-left">Windows</td>
<td class="org-left">NT 3.51</td>
<td class="org-left">TCP and UDP</td>
<td class="org-right">32</td>
</tr>

<tr>
<td class="org-left">Windows</td>
<td class="org-left">NT 4.0</td>
<td class="org-left">TCP and UDP</td>
<td class="org-right">128</td>
</tr>

<tr>
<td class="org-left">Windows</td>
<td class="org-left">NT 4.0 SP5-</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">32</td>
</tr>

<tr>
<td class="org-left">Windows</td>
<td class="org-left">NT 4.0 SP6+</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">128</td>
</tr>

<tr>
<td class="org-left">Windows</td>
<td class="org-left">NT 4 WRKS SP 3, SP 6a</td>
<td class="org-left">ICMP</td>
<td class="org-right">128</td>
</tr>

<tr>
<td class="org-left">Windows</td>
<td class="org-left">NT 4 Server SP4</td>
<td class="org-left">ICMP</td>
<td class="org-right">128</td>
</tr>

<tr>
<td class="org-left">Windows</td>
<td class="org-left">ME</td>
<td class="org-left">ICMP</td>
<td class="org-right">128</td>
</tr>

<tr>
<td class="org-left">Windows</td>
<td class="org-left">2000 pro</td>
<td class="org-left">ICMP/TCP/UDP</td>
<td class="org-right">128</td>
</tr>

<tr>
<td class="org-left">Windows</td>
<td class="org-left">2000 family</td>
<td class="org-left">ICMP</td>
<td class="org-right">128</td>
</tr>

<tr>
<td class="org-left">Windows</td>
<td class="org-left">Server 2003</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">128</td>
</tr>

<tr>
<td class="org-left">Windows</td>
<td class="org-left">XP</td>
<td class="org-left">ICMP/TCP/UDP</td>
<td class="org-right">128</td>
</tr>

<tr>
<td class="org-left">Windows</td>
<td class="org-left">Vista</td>
<td class="org-left">ICMP/TCP/UDP</td>
<td class="org-right">128</td>
</tr>

<tr>
<td class="org-left">Windows</td>
<td class="org-left">7</td>
<td class="org-left">ICMP/TCP/UDP</td>
<td class="org-right">128</td>
</tr>

<tr>
<td class="org-left">Windows</td>
<td class="org-left">Server 2008</td>
<td class="org-left">ICMP/TCP/UDP</td>
<td class="org-right">128</td>
</tr>

<tr>
<td class="org-left">Windows</td>
<td class="org-left">10</td>
<td class="org-left">ICMP/TCP/UDP</td>
<td class="org-right">128</td>
</tr>
</tbody>
</table>

<p>
但其实这张表可以缩减为:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Device / OS</th>
<th scope="col" class="org-right">TTL</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">*nix (Linux/Unix)</td>
<td class="org-right">64</td>
</tr>

<tr>
<td class="org-left">Windows</td>
<td class="org-right">128</td>
</tr>

<tr>
<td class="org-left">Solaris/AIX</td>
<td class="org-right">254</td>
</tr>
</tbody>
</table>

<p>
因此，大概可以推测出 <code>sachachua.com</code> 使用的是*nix类操作系统,当然很大可能就是Linux操作系统
</p></li>
</ol>

</div>
</div>
<div>
  <div class="post-meta">
    <span title="post date" class="post-info">2018-02-07</span>
    <span title="last modification date" class="post-info">2018-02-07</span>
    <span title="tags" class="post-info"><a href="/tags/linux和它的小伙伴">linux和它的小伙伴</a></span>
    <span title="author" class="post-info">lujun9972</span>
  </div>
  <script src="/media/js/jquery-2.1.3.min.js"></script>
  <script src="/media/js/md5.min.js"></script>
  <section>
      <div id="gitalk-container"></div>
      <script type="text/javascript">
       var gitalk = new Gitalk({
           clientID: 'fdcb5d9da3f4acb4862c',
           clientSecret: 'dd0a16312a206782cb7669dcec5e96874ab48170',
           repo: 'lujun9972.github.com',
           owner: 'lujun9972',
           admin: ['lujun9972'],
           id: md5(location.pathname),      // Ensure uniqueness and length less than 50
           distractionFreeMode: false  // Facebook-like distraction free mode
       })
       gitalk.render('gitalk-container')
      </script>
  </section>
  <script src="/media/js/kdComment.js"></script>
      <script>
       var _hmt = _hmt || [];
       (function() {
           var hm = document.createElement("script");
           hm.src = "https://hm.baidu.com/hm.js?7bac4fd0247f69c27887e0d4e3aee41e";
           var s = document.getElementsByTagName("script")[0]; 
           s.parentNode.insertBefore(hm, s);
       })();
      </script>
  <div class="footer">
    <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 26.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
    <p>
      Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:lujun9972 &lt;at&gt; T520">lujun9972</a>
      &nbsp;&nbsp;-&nbsp;&nbsp;
      Powered by <a href="https://github.com/emacs-china/EGO" target="_blank">EGO</a><br/>
      Themed with <a href="https://github.com/kuangdash/emacs_love" target="_blank">emacs_love</a>
        <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
      <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
    </p>
  </div>
    </div>

  </body>
</html>
