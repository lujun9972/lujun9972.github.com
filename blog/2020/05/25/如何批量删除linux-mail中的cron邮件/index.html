<!DOCTYPE html>
<html lang="en">
<head>
  <title>如何批量删除Linux mail中的Cron邮件 - 暗无天日</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="author" content="lujun9972" />
  <meta name="keywords" content="linux和它的小伙伴 cron" />
  <style>
   #ds-thread #ds-reset .ds-comment-body p {color: #ffffff;}
   #disqus_thread a {color: #00ffff;}
  </style>
  <link rel="stylesheet" media="screen" href="../../../../../media/css/font.css" rel="stylesheet" type="text/css"/>
  <link rel="stylesheet" href="../../../../../media/css/main.css" type="text/css">
  <link rel="stylesheet" href="../../../../../media/css/org-src-fontify.css" type="text/css">
  <link rel="stylesheet" href="../../../../../media/css/kdComment.css" type="text/css">
  <script type="text/javascript"
          src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
</head>

  <body class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="../../../../../">暗无天日</a></h1>
    <p>=============&gt;DarkSun的个人博客</p>
    <nav class="site-nav">
      <div class="menu-icon">
      </div>
      <ul class="trigger">
              <li><a href="../../../../../years/">Years</a></li>
              <li><a href="../../../../../tags/">Tags</a></li>
              <li><a href="../../../../../about/">About</a></li>
              <li><a href="git@github.com:lujun9972/lujun9972.github.com.git">Github</a></li>
              <li><a href="../../../../../rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="http://www.google.com/search">
        <input type="text" class="field" name="q" id="s" placeholder="Search">
        <input type="hidden" name="as_sitesearch" value="lujun9972.github.io">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">如何批量删除Linux mail中的Cron邮件</h1>
<p>
我在 cron 中设置了每天定时运行 <a href="https://github.com/LCTT/TranslateProject">Linux中国</a> 的选题脚本。然后由于cron会将任务的执行结果通过邮件通知用户，这样一来过了一段时间后我的 mail box 中就充满了 CRON 发来邮箱了。
</p>

<p>
看了网上的一些资料，我知道可以通过 <code>echo 'd *'|mail</code> 来删除所有 mail box 中的邮件，但是这样会把非 CRON 的邮件也删掉，这不是我想要的。
</p>

<p>
好在翻阅了一下 <code>man mail</code> 发现 <code>d</code> 命令后面可以通过直接跟 <code>发件人地址</code> 或 <code>/关键字</code> 的方式删除指定发件人的邮件，或删除标题中包含 <code>关键字</code> 的邮件。
</p>

<p>
由于所有的 <code>CRON</code> 发送的邮件都以 <code>(Cron Daemon)</code> 作为发件人，因此可以通过 <code>echo '"(Cron Daemon)"'|mail</code> 来删除所有 CRON 发出的邮件（这里不要忘了括号外的双引号，因为 <code>()</code> 在指定邮件的语法中有特殊意义）
</p>

<p>
那么若我只是想删除某个 CRON 任务发送的邮件又该怎么办呢？ 
<code>CRON</code> 发送的邮件的标题格式一般都是这样的 <code>Cron &lt;主机名&gt; CRON命令</code>.
</p>
<div class="org-src-container">
<pre class="src src-shell"><span class="org-builtin">echo</span> -n |mail
</pre>
</div>

<div class="org-src-container">
<pre class="src src-org">Heirloom Mail version 12.5 7/5/10.  Type ? for help.
"/var/spool/mail/lujun9972": 11 messages 10 unread
&gt;U  1 (Cron Daemon)         Mon May 25 15:03  26/964   "Cron <a href="mailto:lujun9972%40VM_0_8_centos">&lt;lujun9972@VM_0_8_centos&gt;</a> date"
 U  2 (Cron Daemon)         Mon May 25 15:04  26/964   "Cron <a href="mailto:lujun9972%40VM_0_8_centos">&lt;lujun9972@VM_0_8_centos&gt;</a> date"
 U  3 (Cron Daemon)         Mon May 25 15:05  26/964   "Cron <a href="mailto:lujun9972%40VM_0_8_centos">&lt;lujun9972@VM_0_8_centos&gt;</a> date"
 U  4 (Cron Daemon)         Mon May 25 15:06  26/964   "Cron <a href="mailto:lujun9972%40VM_0_8_centos">&lt;lujun9972@VM_0_8_centos&gt;</a> date"
 U  5 (Cron Daemon)         Mon May 25 15:07  26/964   "Cron <a href="mailto:lujun9972%40VM_0_8_centos">&lt;lujun9972@VM_0_8_centos&gt;</a> date"
 U  6 (Cron Daemon)         Mon May 25 15:08  26/964   "Cron <a href="mailto:lujun9972%40VM_0_8_centos">&lt;lujun9972@VM_0_8_centos&gt;</a> date"
    7 (Cron Daemon)         Mon May 25 15:09  26/965   "Cron <a href="mailto:lujun9972%40VM_0_8_centos">&lt;lujun9972@VM_0_8_centos&gt;</a> date"
 U  8 (Cron Daemon)         Mon May 25 15:10  26/964   "Cron <a href="mailto:lujun9972%40VM_0_8_centos">&lt;lujun9972@VM_0_8_centos&gt;</a> date"
 U  9 (Cron Daemon)         Mon May 25 15:11  26/964   "Cron <a href="mailto:lujun9972%40VM_0_8_centos">&lt;lujun9972@VM_0_8_centos&gt;</a> date"
 U 10 (Cron Daemon)         Mon May 25 15:12  26/964   "Cron <a href="mailto:lujun9972%40VM_0_8_centos">&lt;lujun9972@VM_0_8_centos&gt;</a> date"
 U 11 (Cron Daemon)         Mon May 25 15:13  26/964   "Cron <a href="mailto:lujun9972%40VM_0_8_centos">&lt;lujun9972@VM_0_8_centos&gt;</a> date"
Held 11 messages in /var/spool/mail/lujun9972
</pre>
</div>

<p>
因此，我们可以通过 <code>echo 'd /命令关键字'|mail</code> 来删除某个特定任务的邮件，比如下面命令删除 <code>date</code> 命令产生的邮件：
</p>
<div class="org-src-container">
<pre class="src src-shell"><span class="org-builtin">echo</span> <span class="org-string">'d /date'</span> |mail
<span class="org-builtin">echo</span> -n |mail
</pre>
</div>

<div class="org-src-container">
<pre class="src src-org">No mail for lujun9972
</pre>
</div>

<p>
<code>mail</code> 命令中关于指定邮件的语法特别灵活，下面说明摘取自 <code>man mail</code>
</p>
<div class="org-src-container">
<pre class="src src-shell">man mail |sed -n <span class="org-string">'/Specifying messages/,/Replying to or originating mail/p'</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-org">Specifying messages
    Commands  such  as print and delete can be given a list of message num&#8208;
    bers as arguments to apply to a  number  of  messages  at  once.   Thus
    `delete  1 2' deletes messages 1 and 2, while `delete 1-5' deletes mes&#8208;
    sages 1 through 5.  In sorted or threaded mode (see the sort and thread
    commands),  `delete  1-5' deletes the messages that are located between
    (and including) messages 1 through 5 in the sorted/threaded  order,  as
    shown  in  the  header  summary.   The  following special message names
    exist:

    :n     All new messages.

    :o     All old messages (any not in state read or new).

    :u     All unread messages.

    :d     All deleted messages (for the undelete command).

    :r     All read messages.

    :f     All `flagged' messages.

    :a     All answered messages (cf. the markanswered variable).

    :t     All messages marked as draft.

    :k     All `killed' messages.

    :j     All messages classified as junk.

    .      The current message.

    ;      The message that was previously the current message.

    ,      The parent message of the current message, that is  the  message
           with  the  Message-ID  given  in the `In-Reply-To:' field or the
           last entry of the `References:' field of the current message.

    -      The next  previous  undeleted  message,  or  the  next  previous
           deleted  message  for  the undelete command.  In sorted/threaded
           mode, the next previous  such  message  in  the  sorted/threaded
           order.

    +      The  next undeleted message, or the next deleted message for the
           undelete command.  In sorted/threaded mode, the next  such  mes&#8208;
           sage in the sorted/threaded order.

    ^      The  first  undeleted  message, or the first deleted message for
           the undelete command.  In sorted/threaded mode, the  first  such
           message in the sorted/threaded order.

    $      The  last message.  In sorted/threaded mode, the last message in
           the sorted/threaded order.

    &amp;x     In threaded mode, selects the message addressed with x, where  x
           is  any  other  message specification, and all messages from the
           thread that begins at it.  Otherwise, it is identical to x.   If
           x  is  omitted, the thread beginning with the current message is
           selected.

    *      All messages.

    `      All messages that were included in the message list for the pre&#8208;
           vious command.

    /string
           All  messages  that  contain  string  in the subject field (case
           ignored).  See also the searchheaders variable.   If  string  is
           empty,  the  string from the previous specification of that type
           is used again.

    address
           All messages from address.  By default, this is a case-sensitive
           search  for  the complete email address.  If the allnet variable
           is set, only the local part of the addresses  is  evaluated  for
           the  comparison.   Otherwise  if the showname variable is set, a
           case-sensitive search for the complete real name of a sender  is
           performed.  The IMAP-style (from address) expression can be used
           instead if substring matches are desired.

    (criterion)
           All messages that satisfy the given IMAP-style SEARCH criterion.
           This addressing mode is available with all types of folders; for
           folders not located on IMAP servers, or for  servers  unable  to
           execute  the  SEARCH  command,  mailx  will  perform  the search
           locally.  Strings must be enclosed by double quotes `"' in their
           entirety  if they contain white space or parentheses; within the
           quotes, only backslash `\' is recognized as an escape character.
           All  string searches are case-insensitive.  When the description
           indicates that the `envelope' representation of an address field
           is  used,  this  means that the search string is checked against
           both a list constructed as

           ("real name" "source-route" "local-part" "domain-part")

           for each address, and the addresses without real names from  the
           respective header field.  Criteria can be nested using parenthe&#8208;
           ses.

    (criterion1 criterion2 ... criterionN)
           All messages that satisfy all of the given criteria.

    (or criterion1 criterion2)
           All messages that satisfy either criterion1  or  criterion2,  or
           both.  To connect more than two criteria using `or', (or) speci&#8208;
           fications have to be nested  using  additional  parentheses,  as
           with  `(or a (or b c))';  `(or a b c)'  means  ((a or b) and c).
           For a simple `or' operation of independent criteria on the  low&#8208;
           est  nesting level, it is possible to achieve similar effects by
           using three separate criteria, as with `(a) (b) (c)'.

    (not criterion)
           All messages that do not satisfy criterion.

    (bcc string)
           All messages that contain string in the  `envelope'  representa&#8208;
           tion of the Bcc: field.

    (cc string)
           All  messages  that contain string in the `envelope' representa&#8208;
           tion of the Cc: field.

    (from string)
           All messages that contain string in the  `envelope'  representa&#8208;
           tion of the From: field.

    (subject string)
           All messages that contain string in the Subject: field.

    (to string)
           All  messages  that contain string in the `envelope' representa&#8208;
           tion of the To: field.

    (header name string)
           All messages that contain string in the specified Name: field.

    (body string)
           All messages that contain string in their body.

    (text string)
           All messages that contain string in their header or body.

    (larger size)
           All messages that are larger than size (in bytes).

    (smaller size)
           All messages that are smaller than size (in bytes).

    (before date)
           All messages that were received before date; date must be in the
           form d[d]-mon-yyyy, where d[d] is the day of the month as one or
           two digits, mon is the name of the month&#8212;one  of  `Jan',  `Feb',
           `Mar',  `Apr',  `May', `Jun', `Jul', `Aug', `Sep', `Oct', `Nov',
           or  `Dec',  and  yyyy  is  the  year  as   four   digits;   e.g.
           "30-Aug-2004".

    (on date)
           All messages that were received on the specified date.

    (since date)
           All messages that were received since the specified date.

    (sentbefore date)
           All messages that were sent on the specified date.

    (senton date)
           All messages that were sent on the specified date.

    (sentsince date)
           All messages that were sent since the specified date.

    ()     The  same criterion as for the previous search.  This specifica&#8208;
           tion cannot be used as part of another criterion.  If the previ&#8208;
           ous  command line contained more than one independent criterion,
           the last of those criteria is used.

    A practical method to read a set of messages is to issue a from command
    with  the  search criteria first to check for appropriate messages, and
    to read each single message then by typing ``' repeatedly.

Replying to or originating mail
</pre>
</div>

</div>
</div>
<div>
  <div class="post-meta">
    <span title="post date" class="post-info">2020-05-25</span>
    <span title="last modification date" class="post-info">2020-05-25</span>
    <span title="tags" class="post-info"><a href="../../../../../tags/linux和它的小伙伴-cron">linux和它的小伙伴 cron</a></span>
    <span title="author" class="post-info">lujun9972</span>
  </div>
  <script src="../../../../../media/js/jquery-2.1.3.min.js"></script>
  <script src="../../../../../media/js/md5.min.js"></script>
  <!-- 添加一叶 -->
  <link href="https://yiyechat.com/open-source/build/content-static/css/main.css" rel="stylesheet">
  <script src="https://yiyechat.com/open-source/build/content-static/js/main.js" ></script>
  <section>
      <div id="gitalk-container"></div>
      <script type="text/javascript">
       var gitalk = new Gitalk({
           clientID: 'fdcb5d9da3f4acb4862c',
           clientSecret: 'dd0a16312a206782cb7669dcec5e96874ab48170',
           repo: 'lujun9972.github.com',
           owner: 'lujun9972',
           admin: ['lujun9972'],
           id: md5(location.pathname),      // Ensure uniqueness and length less than 50
           distractionFreeMode: false  // Facebook-like distraction free mode
       })
       gitalk.render('gitalk-container')
      </script>
  </section>
  <script src="../../../../../media/js/kdComment.js"></script>
      <script>
       var _hmt = _hmt || [];
       (function() {
           var hm = document.createElement("script");
           hm.src = "https://hm.baidu.com/hm.js?7bac4fd0247f69c27887e0d4e3aee41e";
           var s = document.getElementsByTagName("script")[0]; 
           s.parentNode.insertBefore(hm, s);
       })();
      </script>
  <div class="footer">
    <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 27.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
    <p>
      Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:travis &lt;at&gt; travis-job-f81560be-370d-46c9-a3d1-7c17d6e9ec7b">lujun9972</a>
      &nbsp;&nbsp;-&nbsp;&nbsp;
      Powered by <a href="https://github.com/emacs-china/EGO" target="_blank">EGO</a><br/>
      Themed with <a href="https://github.com/kuangdash/emacs_love" target="_blank">emacs_love</a>
        <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="https://licensebuttons.net/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
      <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
    </p>
  </div>
    </div>

  </body>
</html>
