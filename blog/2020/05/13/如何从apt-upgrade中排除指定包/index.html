<!DOCTYPE html>
<html lang="en">
<head>
  <title>如何从apt upgrade中排除指定包 - 暗无天日</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="author" content="lujun9972" />
  <meta name="keywords" content="linux和它的小伙伴" />
  <style>
   #ds-thread #ds-reset .ds-comment-body p {color: #ffffff;}
   #disqus_thread a {color: #00ffff;}
  </style>
  <link rel="stylesheet" media="screen" href="../../../../../media/css/font.css" rel="stylesheet" type="text/css"/>
  <link rel="stylesheet" href="../../../../../media/css/main.css" type="text/css">
  <link rel="stylesheet" href="../../../../../media/css/org-src-fontify.css" type="text/css">
  <link rel="stylesheet" href="../../../../../media/css/kdComment.css" type="text/css">
  <script type="text/javascript"
          src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
</head>

  <body class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="../../../../../">暗无天日</a></h1>
    <p>=============&gt;DarkSun的个人博客</p>
    <nav class="site-nav">
      <div class="menu-icon">
      </div>
      <ul class="trigger">
              <li><a href="../../../../../years/">Years</a></li>
              <li><a href="../../../../../tags/">Tags</a></li>
              <li><a href="../../../../../about/">About</a></li>
              <li><a href="git@github.com:lujun9972/lujun9972.github.com.git">Github</a></li>
              <li><a href="../../../../../rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="http://www.google.com/search">
        <input type="text" class="field" name="q" id="s" placeholder="Search">
        <input type="hidden" name="as_sitesearch" value="lujun9972.github.io">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">如何从apt upgrade中排除指定包</h1>
<p>
在 archlinux 下可以直接通过 <code>pacman -Syu --ingore</code> 来跳过指定包进行升级, 然而ubuntu 下的 apt 居然不提供类似的排除选项，这很让我感到吃惊.
不过网上apt的内容倒是蛮多，经过简单的搜索，很容易找到解决方法。
</p>

<ol class="org-ol">
<li><p>
先用 <code>apt-mark hold</code> 来保留要排除的软件包
</p>
<div class="org-src-container">
<pre class="src src-shell">sudo apt-mark hold emacs-snapshot
</pre>
</div>

<pre class="example">
emacs-snapshot set on hold.

</pre></li>

<li><p>
执行升级操作
</p>
<div class="org-src-container">
<pre class="src src-shell">sudo apt upgrade -y
</pre>
</div></li>

<li><p>
用 <code>apt-mark unhold</code> 来取消包的保留
</p>
<div class="org-src-container">
<pre class="src src-shell">sudo apt-mark unhold emacs-snapshot
</pre>
</div>

<pre class="example">
Canceled hold on emacs-snapshot.

</pre></li>
</ol>


<p>
如果没有 <code>apt-mark</code> 命令，则还可以使用 <code>dpkg --set-selections</code> 来保留软件包，关于它的manual如下：
</p>
<pre class="example">
--set-selections
            Set package selections using file read from stdin. This file should be in the format  “package  state”,
            where  state  is one of install, hold, deinstall or purge. Blank lines and comment lines beginning with
            ‘#’ are also permitted.

            The available file needs to be up-to-date for this command to be  useful,  otherwise  unknown  packages
            will be ignored with a warning. See the --update-avail and --merge-avail commands for more information.
</pre>

<p>
所以步骤可以修改为
</p>
<ol class="org-ol">
<li><p>
保留要排除的软件包
</p>
<div class="org-src-container">
<pre class="src src-shell"><span class="org-builtin">echo</span> <span class="org-string">"emacs-snapshot hold"</span> |sudo dpkg --set-selections
</pre>
</div></li>

<li><p>
执行升级操作
</p>
<div class="org-src-container">
<pre class="src src-shell">sudo apt upgrade -y
</pre>
</div></li>

<li><p>
取消包的保留
</p>
<div class="org-src-container">
<pre class="src src-shell"><span class="org-builtin">echo</span> <span class="org-string">"emacs-snapshot install"</span> |sudo dpkg --set-selections
</pre>
</div></li>
</ol>

</div>
</div>
<div>
  <div class="post-meta">
    <span title="post date" class="post-info">2020-05-13</span>
    <span title="last modification date" class="post-info">2020-05-13</span>
    <span title="tags" class="post-info"><a href="../../../../../tags/linux和它的小伙伴">linux和它的小伙伴</a></span>
    <span title="author" class="post-info">lujun9972</span>
  </div>
  <script src="../../../../../media/js/jquery-2.1.3.min.js"></script>
  <script src="../../../../../media/js/md5.min.js"></script>
  <!-- 添加一叶 -->
  <link href="https://yiyechat.com/open-source/build/content-static/css/main.css" rel="stylesheet">
  <script src="https://yiyechat.com/open-source/build/content-static/js/main.js" ></script>
  <section>
      <div id="gitalk-container"></div>
      <script type="text/javascript">
       var gitalk = new Gitalk({
           clientID: 'fdcb5d9da3f4acb4862c',
           clientSecret: 'dd0a16312a206782cb7669dcec5e96874ab48170',
           repo: 'lujun9972.github.com',
           owner: 'lujun9972',
           admin: ['lujun9972'],
           id: md5(location.pathname),      // Ensure uniqueness and length less than 50
           distractionFreeMode: false  // Facebook-like distraction free mode
       })
       gitalk.render('gitalk-container')
      </script>
  </section>
  <script src="../../../../../media/js/kdComment.js"></script>
      <script>
       var _hmt = _hmt || [];
       (function() {
           var hm = document.createElement("script");
           hm.src = "https://hm.baidu.com/hm.js?7bac4fd0247f69c27887e0d4e3aee41e";
           var s = document.getElementsByTagName("script")[0]; 
           s.parentNode.insertBefore(hm, s);
       })();
      </script>
  <div class="footer">
    <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 27.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
    <p>
      Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:travis &lt;at&gt; travis-job-112b0a27-3ac4-40b3-a79e-8a07d5731876">lujun9972</a>
      &nbsp;&nbsp;-&nbsp;&nbsp;
      Powered by <a href="https://github.com/emacs-china/EGO" target="_blank">EGO</a><br/>
      Themed with <a href="https://github.com/kuangdash/emacs_love" target="_blank">emacs_love</a>
        <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="https://licensebuttons.net/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
      <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
    </p>
  </div>
    </div>

  </body>
</html>
