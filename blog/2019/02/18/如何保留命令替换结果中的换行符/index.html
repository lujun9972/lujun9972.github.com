<!DOCTYPE html>
<html lang="en">
<head>
  <title>如何保留命令替换结果中的换行符 - 暗无天日</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="author" content="lujun9972" />
  <meta name="keywords" content="linux和它的小伙伴" />
  <style>
   #ds-thread #ds-reset .ds-comment-body p {color: #ffffff;}
   #disqus_thread a {color: #00ffff;}
  </style>
  <link rel="stylesheet" media="screen" href="../../../../../media/css/font.css" rel="stylesheet" type="text/css"/>
  <link rel="stylesheet" href="../../../../../media/css/main.css" type="text/css">
  <link rel="stylesheet" href="../../../../../media/css/org-src-fontify.css" type="text/css">
  <link rel="stylesheet" href="../../../../../media/css/kdComment.css" type="text/css">
  <script type="text/javascript"
          src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
</head>

  <body class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="../../../../../">暗无天日</a></h1>
    <p>=============&gt;随便,谢谢</p>
    <nav class="site-nav">
      <div class="menu-icon">
      </div>
      <ul class="trigger">
              <li><a href="../../../../../years/">Years</a></li>
              <li><a href="../../../../../tags/">Tags</a></li>
              <li><a href="../../../../../about/">About</a></li>
              <li><a href="https://github.com/lujun9972/lujun9972.github.com.git">Github</a></li>
              <li><a href="../../../../../rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="http://www.google.com/search">
        <input type="text" class="field" name="q" id="s" placeholder="Search">
        <input type="hidden" name="as_sitesearch" value="lujun9972.github.io">
    </form>
    <img class="avatar" src="https://avatar.csdnimg.cn/6/2/4/1_lujun9972.jpg" />
  </header>
</div>

<div>
<div class="post">
<h1 class="title">如何保留命令替换结果中的换行符</h1>
<p>
我们在用变量保存命令执行的输出时经常会发现命令替换结果中的换行符会被替换成空格，例如下面这个例子:
</p>
<div class="org-src-container">
<pre class="src src-shell">seq 1 2
<span class="org-builtin">echo</span> <span class="org-string">"---------------------------------"</span>
<span class="org-variable-name">a</span>=$(<span class="org-sh-quoted-exec">seq</span> 1 2)
<span class="org-builtin">echo</span> $<span class="org-variable-name">a</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-org">1
2
---------------------------------
1 2
</pre>
</div>

<p>
命令替换结果中的换行符之所以被替换成空格是因为bash对其进行了词划分(word splitting).
</p>

<p>
下面这段说明引用至 <code>Bash Manual</code> 的 <code>Command Substitution</code> 章节
</p>
<div class="org-src-container">
<pre class="src src-org">Command Substitution

       .......

       Bash  performs  the  expansion by executing command and replacing the
       command substitution with the standard output of  the  command,  with
       any  trailing  newlines  deleted.  <span class="org-bold">*Embedded newlines are not deleted,</span>
<span class="org-bold">       but they may be removed during word splitting.*</span>  The command substitu&#8208;
       tion  $(cat  file)  can  be replaced by the equivalent but faster $(&lt;
       file).

       .......

       <span class="org-bold">*,If  the substitution appears within double quotes, word splitting and</span>
<span class="org-bold">       pathname expansion are not performed on the results.*</span>
</pre>
</div>

<p>
而关于 <code>Word Splitting</code> 的说明如下:
</p>
<div class="org-src-container">
<pre class="src src-org">Word Splitting
       The shell scans the results of parameter expansion, command substitu&#8208;
       tion,  and  arithmetic  expansion  that  <span class="org-bold">*did  not occur within double</span>
<span class="org-bold">       quotes for word splitting*</span>.

       The shell treats each character of IFS as a delimiter, and splits the
       results  of  the other expansions into words on these characters.  If
       IFS is unset, or its  value  is  exactly  &lt;space&gt;&lt;tab&gt;&lt;newline&gt;,  the
       default,  then  sequences  of  &lt;space&gt;,  &lt;tab&gt;,  and &lt;newline&gt; at the
       beginning and end of the  results  of  the  previous  expansions  are
       ignored,  and  any sequence of IFS characters not at the beginning or
       end serves to delimit words.  If IFS  has  a  value  other  than  the
       default,  then  sequences  of the whitespace characters space and tab
       are ignored at the beginning and end of the  word,  as  long  as  the
       whitespace  character is in the value of IFS (an IFS whitespace char&#8208;
       acter).  Any character in IFS that is not IFS whitespace, along  with
       any adjacent IFS whitespace characters, delimits a field.  A sequence
       of IFS whitespace characters is also treated as a delimiter.  If  the
       value of IFS is null, no word splitting occurs.

       Explicit  null  arguments ("" or '') are retained.  Unquoted implicit
       null arguments, resulting from the expansion of parameters that  have
       no  values,  are  removed.   If a parameter with no value is expanded
       within double quotes, a null argument results and is retained.

       Note that if no expansion occurs, no splitting is performed.
</pre>
</div>

<p>
从这两个说明中我们可以发现，要保留命令替换结果中的换行符，有两种方法:
</p>

<ol class="org-ol">
<li><p>
把命令替换放到双引号中,如下所示:
</p>
<div class="org-src-container">
<pre class="src src-shell"><span class="org-variable-name">a</span>=<span class="org-string">"$(</span><span class="org-sh-quoted-exec">seq</span><span class="org-string"> 1 2)"</span>
<span class="org-builtin">echo</span> <span class="org-string">"$a"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-org">1
2
</pre>
</div></li>

<li><p>
将 <code>IFS</code> 设置为空，如下所示:
</p>
<div class="org-src-container">
<pre class="src src-shell"><span class="org-variable-name">IFS</span>=<span class="org-string">''</span>
<span class="org-variable-name">a</span>=$(<span class="org-sh-quoted-exec">seq</span> 1 2)
<span class="org-builtin">echo</span> $<span class="org-variable-name">a</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-org">1
2
</pre>
</div></li>
</ol>

</div>
</div>
<div>
  <div class="post-meta">
    <span title="post date" class="post-info">2019-02-18</span>
    <span title="last modification date" class="post-info">2019-02-18</span>
    <span title="tags" class="post-info"><a href="../../../../../tags/linux和它的小伙伴">linux和它的小伙伴</a></span>
    <span title="author" class="post-info">lujun9972</span>
  </div>
  <script src="../../../../../media/js/jquery-2.1.3.min.js"></script>
  <script src="../../../../../media/js/md5.min.js"></script>
  <section>
      <div id="gitalk-container"></div>
      <script type="text/javascript">
       var gitalk = new Gitalk({
           clientID: 'fdcb5d9da3f4acb4862c',
           clientSecret: 'dd0a16312a206782cb7669dcec5e96874ab48170',
           repo: 'lujun9972.github.com',
           owner: 'lujun9972',
           admin: ['lujun9972'],
           id: md5(location.pathname),      // Ensure uniqueness and length less than 50
           distractionFreeMode: false  // Facebook-like distraction free mode
       })
       gitalk.render('gitalk-container')
      </script>
  </section>
  <script src="../../../../../media/js/kdComment.js"></script>
      <script>
       var _hmt = _hmt || [];
       (function() {
           var hm = document.createElement("script");
           hm.src = "https://hm.baidu.com/hm.js?7bac4fd0247f69c27887e0d4e3aee41e";
           var s = document.getElementsByTagName("script")[0]; 
           s.parentNode.insertBefore(hm, s);
       })();
      </script>
  <div class="footer">
    <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 27.x(<a href="http://orgmode.org">Org mode</a> 9.x)</p>
    <p>
      Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:travis &lt;at&gt; travis-job-f8772794-b08b-46a0-b59c-8346357cb3da">lujun9972</a>
      &nbsp;&nbsp;-&nbsp;&nbsp;
      Powered by <a href="https://github.com/emacs-china/EGO" target="_blank">EGO</a><br/>
      Themed with <a href="https://github.com/kuangdash/emacs_love" target="_blank">emacs_love</a>
        <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="https://licensebuttons.net/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
      <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
    </p>
  </div>
    </div>

  </body>
</html>
