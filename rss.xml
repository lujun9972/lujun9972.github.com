<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
  <channel>
    <title>暗无天日</title>
    <link>https://lujun9972.github.io</link>
    <description>=============&gt;DarkSun的个人博客</description>
    <pubDate>Mon, 25 Jan 2021 14:24:11 UTC</pubDate>
    <lastBuildDate>Mon, 25 Jan 2021 14:24:11 UTC</lastBuildDate>
    <docs>http://www.rssboard.org/rss-specification</docs>
    <generator>ego static site generator (https://github.com/emacs-china/ego)</generator>
<item>
<title>笑话理解之Bark</title>
<link>https://lujun9972.github.io/blog/2021/01/25/笑话理解之bark/index.html</link>
<description>* Bark
#+begin_example
  Teacher: &quot;What do we call the outer part of a tree?&quot;

  Pupil: &quot;Don&#39;t know Miss!&quot;

  Teacher: &quot;Bark, silly, bark!&quot;

  Pupil: &quot;Woof, woof!&quot;
#+end_example

=Bark= 既有 =树皮= 的意思，也有 =狗叫= 的意思。
</description>
<pubDate>2021-01-25</pubDate>
<guid>https://lujun9972.github.io/blog/2021/01/25/笑话理解之bark/index.html</guid>
</item>
<item>
<title>笑话理解之HotWater</title>
<link>https://lujun9972.github.io/blog/2020/12/21/笑话理解之hotwater/index.html</link>
<description>
* How are men like noodles?
#+begin_example
  How are men like noodles?

  They are always in hot water, they lack taste, and they need dough.
#+end_example

这个双关比较多：
+ =hot water= 即是 =热水= 也表示 =困境=
+ =taste= 即是 =味道= 也表示 =品位=
+ =dough= 即是 =生面团= 在美国俚语中也表示 =金钱=
</description>
<pubDate>2020-12-21</pubDate>
<guid>https://lujun9972.github.io/blog/2020/12/21/笑话理解之hotwater/index.html</guid>
</item>
<item>
<title>笑话理解之Leak</title>
<link>https://lujun9972.github.io/blog/2020/12/21/笑话理解之leak/index.html</link>
<description>
* have a leak
#+begin_example
  One day a man was at a hotel and had a leak in his sink.

  So, he calls the front desk and says: &quot;I have a leak.&quot;

  Then the front desk person says: &quot;Go ahead.&quot;
#+end_example


=leak= 是 =漏水= 的意思，但是 =have a leak= 则是 =(随地)小便= 的意思
</description>
<pubDate>2020-12-21</pubDate>
<guid>https://lujun9972.github.io/blog/2020/12/21/笑话理解之leak/index.html</guid>
</item>
<item>
<title>笑话理解之Major</title>
<link>https://lujun9972.github.io/blog/2020/12/21/笑话理解之major/index.html</link>
<description>* A flat major
#+begin_example
  What do you get when you drop a piano on an army base?

  A flat major.
#+end_example

=major= 即表示 =音乐中的大调= 也有 =空军少校= 的意思。
</description>
<pubDate>2020-12-21</pubDate>
<guid>https://lujun9972.github.io/blog/2020/12/21/笑话理解之major/index.html</guid>
</item>
<item>
<title>笑话理解之Hearing</title>
<link>https://lujun9972.github.io/blog/2020/12/09/笑话理解之hearing/index.html</link>
<description>* The Hearing Problem
#+begin_example
  In a church one Sunday morning a preacher said, &quot;Anyone with &#39;special needs&#39; who wants to be prayed over, please come forward to the front of the altar.&quot;

  With that, Peter got in line and when it was his turn the Preacher asked, &quot;Peter, what do you want me to pray about for you?&quot;

  He replied, &quot;Preacher, I need you to pray for help with my hearing.&quot;

  The preacher put one finger of one hand on Peter&#39;s ear, placed his other hand on top of Peter&#39;s head, and then prayed and prayed and the whole congregation joined in with much enthusiasm.

  After a few minutes, the preacher removed his hands, stood back and asked, &quot;Peter, how is your hearing now?&quot;

  Peter answered, &quot;I don&#39;t know. My hearing is actually next Thursday in the magistrate court.&quot;
#+end_example

=hearing= 既有 =听力= 也有 =听证会= 的意思。
</description>
<pubDate>2020-12-09</pubDate>
<guid>https://lujun9972.github.io/blog/2020/12/09/笑话理解之hearing/index.html</guid>
</item>
<item>
<title>笑话理解之Mature</title>
<link>https://lujun9972.github.io/blog/2020/12/09/笑话理解之mature/index.html</link>
<description>* The difference between government bonds and men
#+begin_example
  What&#39;s the difference between government bonds and men?

  Bonds mature.
#+end_example

=mature= 既有 =到期= 的意思，也有 =成熟= 的意思。政府债券会到期，而男人永远不会成熟。
</description>
<pubDate>2020-12-09</pubDate>
<guid>https://lujun9972.github.io/blog/2020/12/09/笑话理解之mature/index.html</guid>
</item>
<item>
<title>ssh偶发性登录卡死之谜</title>
<link>https://lujun9972.github.io/blog/2020/12/08/ssh偶发性登录卡死之谜/index.html</link>
<description>* 现象
今天遇到一个非常诡异的 ssh 登陆失败的情况，：

1. 通过 ssh 登陆某主机（假设为user@Server）经常卡死，但经过多次尝试偶尔会出现登陆成功的情况。
2. 尝试用 ssh 登陆该主机的其他用户（tmpusr@Server），经常能成功，但是多次尝试会出现偶尔登陆卡死的情况。
3. 使用 ssh -vvv user@Server 尝试调试，发现能够正常登陆，而且每次都能登陆成功。

* 排查过程
1. 使用 =strace -yo /tmp/ssh.log ssh user@server= 追踪系统调用情况，发现卡在了 =read socket= 上了，也就是在等待 =Server= 回复内容一直没等待。

2. 使用 =netstat= 观察 Client 端的网络链接情况
   #+begin_src shell
     netstat -tuanpe |grep ssh
   #+end_src
   结果为
   #+begin_example
     (Not all processes could be identified, non-owned process info
      will not be shown, you would have to be root to see it all.)
     tcp        0      1 10.7.2.3:60078          10.8.24.17:22           SYN_SENT    5000       152156234  4772/ssh
   #+end_example

   连接状态 SYN_SENT 为 TCP 建立链接三次握手的第一步，表示已经发了SYN信号给Server，但并未收到Server回复的SYN ACK

3. 使用 =netstat= 观察 Server 端的网络链接情况
   #+begin_src shell
     netstat -an |grep &#39;ServerIP.22&#39;|grep &#39;ClientIP&#39;
   #+end_src
   结果为
   #+begin_example
     tcp4       0      0  ServerIP.22          ClientIP.60078         SYN_RCVD
   #+end_example

   连接状态 SYN_RCVD 为 TCP 建立链接三次握手的第二步，表示 Server 确实已经收到了 Client 发来的SYN信号，且回复了SYN ACK

4. 通过步骤2和3,我们可以推测出 ssh 登陆卡死的原因是 Server 回复的 SYN ACK 没有发送到 Client 端，导致 TCP 链接无法创建起来。

5. 使用 ping 大包的方式检测网络质量
   #+begin_src shell
     ping -s 65508 ClientIP
   #+end_src
   结果为
   #+begin_example
     65515 bytes from ClientIP: icmp_seq=0 ttl=63 time=0 ms
     65515 bytes from ClientIP: icmp_seq=1 ttl=63 time=0 ms
     65515 bytes from ClientIP: icmp_seq=2 ttl=63 time=0 ms
     65515 bytes from ClientIP: icmp_seq=3 ttl=63 time=0 ms
     65515 bytes from ClientIP: icmp_seq=4 ttl=63 time=0 ms
     65515 bytes from ClientIP: icmp_seq=5 ttl=63 time=0 ms
   #+end_example
   可以判断网络质量并不差

6. 检查Server端的路由配置
   #+begin_src shell
     netstat -r
   #+end_src
   结果为
   #+begin_example
     Routing tables
     Destination        Gateway           Flags   Refs     Use  If   Exp  Groups

     Route Tree for Protocol Family 2 (Internet):
     default            XX.XX.XX.XX         UG        3   2048482 en0      -      -
     ClientNet            YY.YY.YY.YY      UG        2    181966 en2      -      -   =&gt;
     ClientNet            YY.YY.YY.YY      UG        1    178100 en0      -      -
   #+end_example

   很惊奇的发现发送到 Client所在网络的路由配了两个，分别使用 =en2= 和 =en0= 两个网卡

7. 检查这两个网卡的IP配置发现只有 =en2= 这个网卡是与网关相通的，而 =en0= 这个网卡并不通。

* 解决方法
删除多余的错误路由配置后恢复正常。
#+begin_src shell
  sudo route del ClientNet dev en0
#+end_src

* 疑问
虽说问题解决了，但还有些奇怪的现象无法解释：

1. 为什么登陆 =user◎Server= 的成功率低，而登陆 =tmpusr@Server= 的成功率高呢？
2. =ssh -vvv user@Server= 与 =ssh user@Server= 的登陆过程有什么不同，为什么加了调试项就能正常登陆呢？

希望能有大佬能给出原因。
</description>
<pubDate>2020-12-08</pubDate>
<guid>https://lujun9972.github.io/blog/2020/12/08/ssh偶发性登录卡死之谜/index.html</guid>
</item>
<item>
<title>笑话理解之Positive</title>
<link>https://lujun9972.github.io/blog/2020/12/06/笑话理解之positive/index.html</link>
<description>* A positive atom
#+begin_example
  A hydrogen atom lost its electron and went to the police station to file a missing electron report. He was questioned by the police: &quot;Haven&#39;t you just misplaced it somewhere? Are you sure that your electron is really lost?&quot;



  &quot;I&#39;m positive.&quot; replied the atom.
#+end_example

=positive= 既有 =肯定,确定= 的意思，也有 =正的，阳性= 的意思。当原子失去电子后，就变成 =正= 的了。
</description>
<pubDate>2020-12-06</pubDate>
<guid>https://lujun9972.github.io/blog/2020/12/06/笑话理解之positive/index.html</guid>
</item>
<item>
<title>使用Pi-hole屏蔽广告</title>
<link>https://lujun9972.github.io/blog/2020/12/05/使用pi-hole屏蔽广告/index.html</link>
<description>* 获取Pi的对外IP地址
我们一般通过ssh登陆树莓派来进行管理，因此可以从 =SSH_CONNECTION= 环境变量中获取树莓派的对外IP
#+begin_src shell :dir /ssh:pi@192.168.1.14:
  IP=$(echo ${SSH_CONNECTION}|cut -d &#39; &#39; -f 3)
  echo ${IP}
#+end_src

#+RESULTS:
: 192.168.1.14

=SSH_CONNECTION= 变量标识了ssh链接的客户端和服务端信息，该变量包含了四个用空格分隔的值，包括：客户端IP地址，客户端端口，服务端IP地址，服务端端口。
详细的说明可以参见 =man ssh=.

* 安装Pi-hole
安装Pi-hole最简单的方法就是用容器了，一行命令搞定：
#+begin_src shell  :dir /ssh:pi@192.168.1.14:
  sudo docker run -d \
    --name=pihole \
    -e TZ=Asia/Chongqing \
    -e WEBPASSWORD=password \
    -e SERVERIP=${IP} \
    -v $(pwd)/etc-pihole:/etc/pihole \
    -v $(pwd)/etc-dnsmasq:/etc/dnsmasq.d \
    -p 443:443/tcp \
    -p 80:80/tcp \
    -p 67:67/udp \
    -p 53:53/tcp \
    -p 53:53/udp \
    --cap-add=NET_ADMIN \
    --restart=unless-stopped \
    pihole/pihole
#+end_src

若使用的是基于Ubuntu的操作系统，那么 =53= 号端口可能会被 =system-resolved= 服务所占用，需要关闭 =DNSStubListener=, 执行如下命令:
#+begin_src shell
  sudo sed -r -i.orig &#39;s/#?DNSStubListener=yes/DNSStubListener=no/g&#39; /etc/systemd/resolved.conf
  sudo systemctl restart systemd-resolved
#+end_src

* 配置DNS
下一步需要配置DNS指向树梅派，为了防止树梅派故障无法提供DNS服务，我不打算改掉之前的DNS，而是在前面加上树梅派作为第一DNS。

创建一个新的 =/etc/resolv.conf.head=,并加入下面内容
#+begin_src conf
  nameserver 192.168.1.14
#+end_src

其中 =192.168.1.14= 为树梅派的IP地址。

* 配置拦截域名
 用 =password= 登陆 =http://$IP/admin=, 选择 Group Management -&gt; Adlists ，为 Default 规则组添加两个URL：
 #+begin_example
   https://gitee.com/privacy-protection-tools/anti-ad/raw/master/domains.txt
   https://share.is26.com/subscribe/adblock.hosts
 #+end_example

 然后再 Tools -&gt; Update Gravity 点击“Update”更新屏蔽域名表
</description>
<pubDate>2020-12-05</pubDate>
<guid>https://lujun9972.github.io/blog/2020/12/05/使用pi-hole屏蔽广告/index.html</guid>
</item>
<item>
<title>笑话理解之Fly</title>
<link>https://lujun9972.github.io/blog/2020/11/26/笑话理解之fly/index.html</link>
<description>
* fly and pussy
#+begin_example
  There was a fly looking at some food in a river. The fly thought, &quot;If I go down, I can get the food!&quot;



  There was a fish looking at the fly. The fish thought, &quot;If the fly goes down to get the food, I can get the fly!&quot;



  There was a bear looking at the fish. The bear thought, &quot;If the fly goes down to get the food, and that fish comes up to get the fly, I can get the fish!&quot;



  There was a man looking at the bear. The man thought, &quot;If the fly goes down to get the food, the fish comes up to get the fly, and the bear gets the fish, I can shoot the bear!&quot;



  There was a mouse looking at the man. The mouse thought, &quot;If the fly goes down to get the food, the fish comes up to get the fly, the bear gets the fish, and the man shoots the bear, I can get the man&#39;s sandwich!&quot;



  There was a cat looking at the mouse. The cat thought, &quot;If the fly goes down to get the food, the fish comes up to get the fly, the bear gets the fish, the man shoots the bear, and the mouse gets the sandwich, I can get the mouse!&quot;



  So the fly goes down to get the food. The fish comes up and gets the fly. The bear swipes his mighty paw and gets the fish. The man shoots the bear. The mouse runs for the man&#39;s sandwich. The cat lunges for the mouse, misses, and falls in the river.



  What&#39;s the moral of the story?



  When the fly goes down, the pussy gets
#+end_example

=pussy= 的双关就不用说了， =fly= 既有 =苍蝇= 的意思，也有 =褲档拉链= 的意思。
</description>
<pubDate>2020-11-26</pubDate>
<guid>https://lujun9972.github.io/blog/2020/11/26/笑话理解之fly/index.html</guid>
</item>
</channel>
</rss>